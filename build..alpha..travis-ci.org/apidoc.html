<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="http://github.com/joehewitt/app.js"

    >app.js (v0.0.21)</a>
</h1>
<h4>Packages Node modules as browser apps.</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.app.js">module app.js</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App">
            function <span class="apidocSignatureSpan">app.js.</span>App
            <span class="apidocSignatureSpan">(conf)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.js.App">
            function <span class="apidocSignatureSpan">app.js.</span>js.App
            <span class="apidocSignatureSpan">(conf)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.js.App.prototype._assignConfig">
            function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype._assignConfig
            <span class="apidocSignatureSpan">(conf)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.js.App.prototype._cleanJSPath">
            function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype._cleanJSPath
            <span class="apidocSignatureSpan">(jsPath, renderer)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.js.App.prototype._listenToSocket">
            function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype._listenToSocket
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.js.App.prototype._loadAppcache">
            function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype._loadAppcache
            <span class="apidocSignatureSpan">(renderer, options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.js.App.prototype._loadAppjs">
            function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype._loadAppjs
            <span class="apidocSignatureSpan">(renderer, options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.js.App.prototype._loadCSS">
            function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype._loadCSS
            <span class="apidocSignatureSpan">(renderer, options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.js.App.prototype._loadHas">
            function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype._loadHas
            <span class="apidocSignatureSpan">(renderer, options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.js.App.prototype._loadJS">
            function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype._loadJS
            <span class="apidocSignatureSpan">(modulePath, renderer, options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.js.App.prototype._loadPage">
            function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype._loadPage
            <span class="apidocSignatureSpan">(URL, renderer, options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.js.App.prototype._loadPolyfills">
            function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype._loadPolyfills
            <span class="apidocSignatureSpan">(renderer, options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.js.App.prototype._loadStatic">
            function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype._loadStatic
            <span class="apidocSignatureSpan">(staticPath, renderer, options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.js.App.prototype._loadURL">
            function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype._loadURL
            <span class="apidocSignatureSpan">(urlParsed, parts, m, renderer, options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.js.App.prototype._prepare">
            function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype._prepare
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.js.App.prototype.getContentScript">
            function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype.getContentScript
            <span class="apidocSignatureSpan">(renderer, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.js.App.prototype.invalidate">
            function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype.invalidate
            <span class="apidocSignatureSpan">(dependentURL)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.js.App.prototype.loadResources">
            function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype.loadResources
            <span class="apidocSignatureSpan">(req, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.js.App.prototype.loadURL">
            function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype.loadURL
            <span class="apidocSignatureSpan">(URL, renderer, options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.js.App.prototype.normalizeURL">
            function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype.normalizeURL
            <span class="apidocSignatureSpan">(URL, category, timestamp)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.js.App.prototype.reloadPage">
            function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype.reloadPage
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.js.App.prototype.route">
            function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype.route
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.js.App.prototype.staticRoute">
            function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype.staticRoute
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.js.route">
            function <span class="apidocSignatureSpan">app.js.</span>js.route
            <span class="apidocSignatureSpan">(conf)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.js.run">
            function <span class="apidocSignatureSpan">app.js.</span>js.run
            <span class="apidocSignatureSpan">(argv)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.js.searchScript">
            function <span class="apidocSignatureSpan">app.js.</span>js.searchScript
            <span class="apidocSignatureSpan">(modulePath, searchPaths, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.js.searchStatic">
            function <span class="apidocSignatureSpan">app.js.</span>js.searchStatic
            <span class="apidocSignatureSpan">(modulePath, searchPaths, isURL, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.js.shortenStaticPath">
            function <span class="apidocSignatureSpan">app.js.</span>js.shortenStaticPath
            <span class="apidocSignatureSpan">(resourcePath, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.route">
            function <span class="apidocSignatureSpan">app.js.</span>route
            <span class="apidocSignatureSpan">(conf)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.run">
            function <span class="apidocSignatureSpan">app.js.</span>run
            <span class="apidocSignatureSpan">(argv)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.searchScript">
            function <span class="apidocSignatureSpan">app.js.</span>searchScript
            <span class="apidocSignatureSpan">(modulePath, searchPaths, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.searchStatic">
            function <span class="apidocSignatureSpan">app.js.</span>searchStatic
            <span class="apidocSignatureSpan">(modulePath, searchPaths, isURL, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.shortenStaticPath">
            function <span class="apidocSignatureSpan">app.js.</span>shortenStaticPath
            <span class="apidocSignatureSpan">(resourcePath, cb)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">app.js.</span>js.App.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">app.js.</span>js.Renderer</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">app.js.</span>js.pkg</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">app.js.</span>js.utils</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.app.js.App">module app.js.App</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.App">
            function <span class="apidocSignatureSpan">app.js.</span>App
            <span class="apidocSignatureSpan">(conf)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.app.js.App.prototype">module app.js.App.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype._assignConfig">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_assignConfig
            <span class="apidocSignatureSpan">(conf)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype._cleanJSPath">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_cleanJSPath
            <span class="apidocSignatureSpan">(jsPath, renderer)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype._listenToSocket">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_listenToSocket
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype._loadAppcache">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadAppcache
            <span class="apidocSignatureSpan">(renderer, options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype._loadAppjs">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadAppjs
            <span class="apidocSignatureSpan">(renderer, options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype._loadCSS">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadCSS
            <span class="apidocSignatureSpan">(renderer, options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype._loadHas">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadHas
            <span class="apidocSignatureSpan">(renderer, options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype._loadJS">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadJS
            <span class="apidocSignatureSpan">(modulePath, renderer, options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype._loadPage">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadPage
            <span class="apidocSignatureSpan">(URL, renderer, options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype._loadPolyfills">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadPolyfills
            <span class="apidocSignatureSpan">(renderer, options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype._loadStatic">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadStatic
            <span class="apidocSignatureSpan">(staticPath, renderer, options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype._loadURL">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadURL
            <span class="apidocSignatureSpan">(urlParsed, parts, m, renderer, options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype._prepare">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_prepare
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype.getContentScript">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>getContentScript
            <span class="apidocSignatureSpan">(renderer, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype.invalidate">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>invalidate
            <span class="apidocSignatureSpan">(dependentURL)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype.loadResources">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>loadResources
            <span class="apidocSignatureSpan">(req, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype.loadURL">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>loadURL
            <span class="apidocSignatureSpan">(URL, renderer, options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype.normalizeURL">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>normalizeURL
            <span class="apidocSignatureSpan">(URL, category, timestamp)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype.reloadPage">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>reloadPage
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype.route">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>route
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype.staticRoute">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>staticRoute
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">app.js.App.prototype.</span>resourceBase</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">app.js.App.prototype.</span>appjsPrefix</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">app.js.App.prototype.</span>reResourcePrefix</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">app.js.App.prototype.</span>appcachePath</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">app.js.App.prototype.</span>cssPath</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">app.js.App.prototype.</span>hasPath</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">app.js.App.prototype.</span>jsPath</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">app.js.App.prototype.</span>polyfillsPath</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">app.js.App.prototype.</span>staticPath</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.app.js.App.prototype._assignConfig">module app.js.App.prototype._assignConfig</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype._assignConfig._assignConfig">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_assignConfig
            <span class="apidocSignatureSpan">(conf)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.app.js.App.prototype._cleanJSPath">module app.js.App.prototype._cleanJSPath</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype._cleanJSPath._cleanJSPath">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_cleanJSPath
            <span class="apidocSignatureSpan">(jsPath, renderer)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.app.js.App.prototype._listenToSocket">module app.js.App.prototype._listenToSocket</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype._listenToSocket._listenToSocket">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_listenToSocket
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.app.js.App.prototype._loadAppcache">module app.js.App.prototype._loadAppcache</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype._loadAppcache._loadAppcache">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadAppcache
            <span class="apidocSignatureSpan">(renderer, options, cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.app.js.App.prototype._loadAppjs">module app.js.App.prototype._loadAppjs</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype._loadAppjs._loadAppjs">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadAppjs
            <span class="apidocSignatureSpan">(renderer, options, cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.app.js.App.prototype._loadCSS">module app.js.App.prototype._loadCSS</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype._loadCSS._loadCSS">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadCSS
            <span class="apidocSignatureSpan">(renderer, options, cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.app.js.App.prototype._loadHas">module app.js.App.prototype._loadHas</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype._loadHas._loadHas">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadHas
            <span class="apidocSignatureSpan">(renderer, options, cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.app.js.App.prototype._loadJS">module app.js.App.prototype._loadJS</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype._loadJS._loadJS">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadJS
            <span class="apidocSignatureSpan">(modulePath, renderer, options, cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.app.js.App.prototype._loadPage">module app.js.App.prototype._loadPage</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype._loadPage._loadPage">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadPage
            <span class="apidocSignatureSpan">(URL, renderer, options, cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.app.js.App.prototype._loadPolyfills">module app.js.App.prototype._loadPolyfills</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype._loadPolyfills._loadPolyfills">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadPolyfills
            <span class="apidocSignatureSpan">(renderer, options, cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.app.js.App.prototype._loadStatic">module app.js.App.prototype._loadStatic</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype._loadStatic._loadStatic">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadStatic
            <span class="apidocSignatureSpan">(staticPath, renderer, options, cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.app.js.App.prototype._loadURL">module app.js.App.prototype._loadURL</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype._loadURL._loadURL">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadURL
            <span class="apidocSignatureSpan">(urlParsed, parts, m, renderer, options, cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.app.js.App.prototype._prepare">module app.js.App.prototype._prepare</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype._prepare._prepare">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_prepare
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.app.js.App.prototype.getContentScript">module app.js.App.prototype.getContentScript</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype.getContentScript.getContentScript">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>getContentScript
            <span class="apidocSignatureSpan">(renderer, cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.app.js.App.prototype.invalidate">module app.js.App.prototype.invalidate</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype.invalidate.invalidate">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>invalidate
            <span class="apidocSignatureSpan">(dependentURL)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.app.js.App.prototype.loadResources">module app.js.App.prototype.loadResources</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype.loadResources.loadResources">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>loadResources
            <span class="apidocSignatureSpan">(req, cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.app.js.App.prototype.loadURL">module app.js.App.prototype.loadURL</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype.loadURL.loadURL">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>loadURL
            <span class="apidocSignatureSpan">(URL, renderer, options, cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.app.js.App.prototype.normalizeURL">module app.js.App.prototype.normalizeURL</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype.normalizeURL.normalizeURL">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>normalizeURL
            <span class="apidocSignatureSpan">(URL, category, timestamp)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.app.js.App.prototype.reloadPage">module app.js.App.prototype.reloadPage</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype.reloadPage.reloadPage">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>reloadPage
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.app.js.App.prototype.route">module app.js.App.prototype.route</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype.route.route">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>route
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.app.js.App.prototype.staticRoute">module app.js.App.prototype.staticRoute</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.App.prototype.staticRoute.staticRoute">
            function <span class="apidocSignatureSpan">app.js.App.prototype.</span>staticRoute
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.app.js.Renderer">module app.js.Renderer</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.Renderer.Renderer">
            function <span class="apidocSignatureSpan">app.js.</span>Renderer
            <span class="apidocSignatureSpan">(app, api, apiCache, baseURLPath)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.app.js.pkg">module app.js.pkg</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.pkg.findPackageInfo">
            function <span class="apidocSignatureSpan">app.js.pkg.</span>findPackageInfo
            <span class="apidocSignatureSpan">(scriptPath, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.pkg.findPackagePath">
            function <span class="apidocSignatureSpan">app.js.pkg.</span>findPackagePath
            <span class="apidocSignatureSpan">(scriptPath, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.pkg.findPackageStaticPath">
            function <span class="apidocSignatureSpan">app.js.pkg.</span>findPackageStaticPath
            <span class="apidocSignatureSpan">(scriptPath, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.pkg.normalizeName">
            function <span class="apidocSignatureSpan">app.js.pkg.</span>normalizeName
            <span class="apidocSignatureSpan">(name, baseName, isURL)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.pkg.searchScript">
            function <span class="apidocSignatureSpan">app.js.pkg.</span>searchScript
            <span class="apidocSignatureSpan">(modulePath, searchPaths, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.pkg.searchStatic">
            function <span class="apidocSignatureSpan">app.js.pkg.</span>searchStatic
            <span class="apidocSignatureSpan">(modulePath, searchPaths, isURL, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.pkg.shortenModulePath">
            function <span class="apidocSignatureSpan">app.js.pkg.</span>shortenModulePath
            <span class="apidocSignatureSpan">(scriptPath, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.pkg.shortenStaticPath">
            function <span class="apidocSignatureSpan">app.js.pkg.</span>shortenStaticPath
            <span class="apidocSignatureSpan">(resourcePath, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.pkg.traceScript">
            function <span class="apidocSignatureSpan">app.js.pkg.</span>traceScript
            <span class="apidocSignatureSpan">(rootModuleName, searchPaths, skipDebug, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.pkg.traceStylesheet">
            function <span class="apidocSignatureSpan">app.js.pkg.</span>traceStylesheet
            <span class="apidocSignatureSpan">(modulePath, searchPaths, recursive, source, sourceLine, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.pkg.traceStylesheets">
            function <span class="apidocSignatureSpan">app.js.pkg.</span>traceStylesheets
            <span class="apidocSignatureSpan">(rootModuleName, searchPaths, cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.app.js.route">module app.js.route</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.route.route">
            function <span class="apidocSignatureSpan">app.js.</span>route
            <span class="apidocSignatureSpan">(conf)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.app.js.run">module app.js.run</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.run.run">
            function <span class="apidocSignatureSpan">app.js.</span>run
            <span class="apidocSignatureSpan">(argv)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.app.js.searchScript">module app.js.searchScript</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.searchScript.searchScript">
            function <span class="apidocSignatureSpan">app.js.</span>searchScript
            <span class="apidocSignatureSpan">(modulePath, searchPaths, cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.app.js.searchStatic">module app.js.searchStatic</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.searchStatic.searchStatic">
            function <span class="apidocSignatureSpan">app.js.</span>searchStatic
            <span class="apidocSignatureSpan">(modulePath, searchPaths, isURL, cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.app.js.shortenStaticPath">module app.js.shortenStaticPath</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.shortenStaticPath.shortenStaticPath">
            function <span class="apidocSignatureSpan">app.js.</span>shortenStaticPath
            <span class="apidocSignatureSpan">(resourcePath, cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.app.js.utils">module app.js.utils</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.app.js.utils.sendSafely">
            function <span class="apidocSignatureSpan">app.js.utils.</span>sendSafely
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.app.js" id="apidoc.module.app.js">module app.js</a></h1>


    <h2>
        <a href="#apidoc.element.app.js.App" id="apidoc.element.app.js.App">
        function <span class="apidocSignatureSpan">app.js.</span>App
        <span class="apidocSignatureSpan">(conf)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function App(conf) {
    this.paths = process.env.NODE_PATH ? process.env.NODE_PATH.split(&#x27;;&#x27;) : [];

    this._assignConfig(conf);

    if (this.repo) {
        this.repo = this.repo.replace(/^~/, process.env.HOME);
    }

    this.base = addTrailingSlash(this.base);
    this.baseLength = this.base.split(&#x22;/&#x22;).length-2;
    this.startupTime = new Date().getTime();

    this.renderer = new Renderer(this, this.api, this.apiCache, this.base);

    if (!this.cache) {
        this.cache = new Cache(null, false, true, true);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.js.App" id="apidoc.element.app.js.js.App">
        function <span class="apidocSignatureSpan">app.js.</span>js.App
        <span class="apidocSignatureSpan">(conf)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function App(conf) {
    this.paths = process.env.NODE_PATH ? process.env.NODE_PATH.split(&#x27;;&#x27;) : [];

    this._assignConfig(conf);

    if (this.repo) {
        this.repo = this.repo.replace(/^~/, process.env.HOME);
    }

    this.base = addTrailingSlash(this.base);
    this.baseLength = this.base.split(&#x22;/&#x22;).length-2;
    this.startupTime = new Date().getTime();

    this.renderer = new Renderer(this, this.api, this.apiCache, this.base);

    if (!this.cache) {
        this.cache = new Cache(null, false, true, true);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.js.App.prototype._assignConfig" id="apidoc.element.app.js.js.App.prototype._assignConfig">
        function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype._assignConfig
        <span class="apidocSignatureSpan">(conf)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">js.App.prototype._assignConfig = function (conf) {
    for (var name in defaults) {
        if (name == &#x22;configs&#x22;) {
            var branch = process.env.NODE_ENV == &#x22;production&#x22;
                         ? defaults.configs.production
                         : defaults.configs.development;
            for (var name in branch) {
                this[name] = name in conf ? conf[name] : branch[name];
            }
        } else {
            this[name] = name in conf ? conf[name] : defaults[name];
        }
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.js.App.prototype._cleanJSPath" id="apidoc.element.app.js.js.App.prototype._cleanJSPath">
        function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype._cleanJSPath
        <span class="apidocSignatureSpan">(jsPath, renderer)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">js.App.prototype._cleanJSPath = function (jsPath, renderer) {
    return jsPath
        ? path.join(path.dirname(jsPath), path.basename(jsPath, &#x27;.js&#x27;))
        : this.client;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.js.App.prototype._listenToSocket" id="apidoc.element.app.js.js.App.prototype._listenToSocket">
        function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype._listenToSocket
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">js.App.prototype._listenToSocket = function () {
    var u = url.parse(&#x27;ws://&#x27; + this.socket);
    var ws = require(&#x22;websocket-server&#x22;);
    this.socketServer = ws.createServer();
    this.socketServer.listen(u.port);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.js.App.prototype._loadAppcache" id="apidoc.element.app.js.js.App.prototype._loadAppcache">
        function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype._loadAppcache
        <span class="apidocSignatureSpan">(renderer, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">js.App.prototype._loadAppcache = function (renderer, options, cb) {
    renderer.renderAppcache(options,
        abind(function(err, result) {
            cb(0, {
                body: result.source,
                mimeType: &#x27;text/cache-manifest&#x27;,
                permanent: options.js == &#x22;inline&#x22; &#x26;&#x26; options.css == &#x22;inline&#x22;
            });
        }, cb)
    );
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.js.App.prototype._loadAppjs" id="apidoc.element.app.js.js.App.prototype._loadAppjs">
        function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype._loadAppjs
        <span class="apidocSignatureSpan">(renderer, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">js.App.prototype._loadAppjs = function (renderer, options, cb) {
    var scriptName;
    if (options.loader == &#x22;static&#x22; || options.js == &#x22;worker&#x22;) {
        scriptName = &#x22;appjs-static.js&#x22;;
    } else if (options.loader == &#x22;dynamic&#x22;) {
        scriptName = &#x22;appjs-dynamic.js&#x22;;
    } else if (options.loader == &#x22;standalone&#x22;) {
        scriptName = &#x22;appjs-standalone.js&#x22;;
    }
    if (scriptName) {
        var appjsPath = path.resolve(__dirname, &#x27;..&#x27;, &#x27;client&#x27;, scriptName);
        renderer.renderScriptRaw(appjsPath, &#x27;&#x27;, options,
            abind(function(err, result) {
                cb(0, {path: appjsPath, body: result.source, dependencies: result.dependencies});
            }, cb)
        );
    } else {
        cb(new Error(&#x22;Loader unspecified&#x22;));
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.js.App.prototype._loadCSS" id="apidoc.element.app.js.js.App.prototype._loadCSS">
        function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype._loadCSS
        <span class="apidocSignatureSpan">(renderer, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">js.App.prototype._loadCSS = function (renderer, options, cb) {
    renderer.renderStylesheet(options,
        abind(function(err, result) {
            cb(0, {path: result.path, body: result.source, dependencies: result.dependencies,
                   permanent: true});
        }, cb)
    );
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.js.App.prototype._loadHas" id="apidoc.element.app.js.js.App.prototype._loadHas">
        function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype._loadHas
        <span class="apidocSignatureSpan">(renderer, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">js.App.prototype._loadHas = function (renderer, options, cb) {
    renderer.renderHas(options, abind(function(err, result) {
        cb(0, {path: result.path, body: result.source, dependencies: result.dependencies});
    }, cb));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.js.App.prototype._loadJS" id="apidoc.element.app.js.js.App.prototype._loadJS">
        function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype._loadJS
        <span class="apidocSignatureSpan">(modulePath, renderer, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">js.App.prototype._loadJS = function (modulePath, renderer, options, cb) {
    var scriptPath = this._cleanJSPath(modulePath, renderer);
    var basePath = scriptPath == this.client ? null : this.client;

    var searchPaths = [basePath];
    if (this.paths.length) {
        searchPaths.push.apply(searchPaths, this.paths);
    }

    pkg.searchScript(scriptPath, searchPaths, abind(function(err, findings) {
        if (findings) {
            renderer.renderScript(findings.path, findings.name, options, true,
                abind(function(err, result) {
                    cb(0, {path: findings.path, name: findings.name, body: result.source,
                           dependencies: result.dependencies, permanent: true});
                }, cb)
            );
        }
    }, cb, this));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.js.App.prototype._loadPage" id="apidoc.element.app.js.js.App.prototype._loadPage">
        function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype._loadPage
        <span class="apidocSignatureSpan">(URL, renderer, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">js.App.prototype._loadPage = function (URL, renderer, options, cb) {
    renderer.renderPage(URL, options, abind(function(err, result) {
        cb(0, {
            body: result.source,
            permanent: options.js == &#x22;inline&#x22; &#x26;&#x26; options.css == &#x22;inline&#x22;,
            dependencies: result.dependencies,
        });
    }, cb));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.js.App.prototype._loadPolyfills" id="apidoc.element.app.js.js.App.prototype._loadPolyfills">
        function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype._loadPolyfills
        <span class="apidocSignatureSpan">(renderer, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">js.App.prototype._loadPolyfills = function (renderer, options, cb) {
    renderer.renderPolyfills(options, abind(function(err, result) {
        cb(0, {path: result.path, body: result.source, dependencies: result.dependencies});
    }, cb));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.js.App.prototype._loadStatic" id="apidoc.element.app.js.js.App.prototype._loadStatic">
        function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype._loadStatic
        <span class="apidocSignatureSpan">(staticPath, renderer, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">js.App.prototype._loadStatic = function (staticPath, renderer, options, cb) {
    pkg.searchStatic(staticPath, this.paths, abind(function(err, filePath) {
        if (filePath) {
            fs.stat(filePath, abind(function(err, stat) {
                var dependencies = [{path: filePath, mtime: stat.mtime.getTime()}];
                fs.readFile(filePath, abind(function(err, source) {
                    if (mime.lookup(filePath) == &#x27;text/css&#x27;) {
                        renderer.compressCSS(source+&#x27;&#x27;, staticPath, options,
                        function(err, source) {
                            cb(0, {path: filePath, body: source, dependencies: dependencies});
                        });
                    } else {
                        cb(0, {path: filePath, body: source, raw: true,
                               dependencies: dependencies});
                    }
                }, cb, this));
            }, cb, this));
        }
    }, cb, this));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.js.App.prototype._loadURL" id="apidoc.element.app.js.js.App.prototype._loadURL">
        function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype._loadURL
        <span class="apidocSignatureSpan">(urlParsed, parts, m, renderer, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">js.App.prototype._loadURL = function (urlParsed, parts, m, renderer, options, cb) {
    if (m) {
        if (parts.length == 2) {
            this._loadAppjs(renderer, options, cb);
        } else {
            if (parts[2] == &#x27;static&#x27;) {
                this._loadStatic(parts.slice(3).join(&#x27;/&#x27;), renderer, options, cb);
            } else if (parts[2] == &#x27;js&#x27;) {
                var userAgent = m[2] ? unescape(m[2].substr(1)) : &#x27;&#x27;;
                if (userAgent) {
                    options.userAgent = userAgent;
                }

                if (parts.length &#x3e; 3) {
                    options.js = &#x27;source&#x27;;
                    options.css = &#x27;included&#x27;;
                }
                this._loadJS(parts.slice(3).join(&#x27;/&#x27;), renderer, options, cb);
            } else if (parts[2] == &#x27;css&#x27;) {
                this._loadCSS(renderer, options, cb);
            } else if (parts[2] == &#x27;cache.manifest&#x27;) {
                this._loadAppcache(renderer, options, cb);
            } else if (parts[2] == &#x27;has&#x27;) {
                this._loadHas(renderer, options, cb);
            } else if (parts[2] == &#x27;polyfills&#x27;) {
                this._loadPolyfills(renderer, options, cb);
            } else {
                cb(&#x22;Not found&#x22;);
            }
        }
    } else if (reRootFiles.exec(parts[1])) {
        var newURL = this.staticPath + &#x27;/&#x27; + this.packageName + &#x27;/&#x27; + parts[1];
        this.loadURL(newURL, renderer, options, cb);
    } else {
        this._loadPage(urlParsed, renderer, options, cb);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.js.App.prototype._prepare" id="apidoc.element.app.js.js.App.prototype._prepare">
        function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype._prepare
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">js.App.prototype._prepare = function (cb) {
    if (!this.dependencies) {
        var searchPaths = this.paths;
        pkg.traceScript(this.client, this.paths, false, abind(function(err, deps) {
            this.dependencies = deps;

            async.parallel([
                ibind(function(next) {
                    hascan.getFeatureDB(_.keys(deps.has), abind(function(err, featureDB) {
                        this.featureDB = featureDB;
                        next(0);
                    }, next, this));
                }, cb, this),

                ibind(function(next) {
                    if (!this.packageName) {
                        pkg.searchScript(this.client, searchPaths, abind(function(err, findings) {
                            pkg.findPackageInfo(findings.path, abind(function(err, result) {
                                this.packageName = result.info.name;
                                next(0);
                            }, cb, this));
                        }, cb, this));
                    } else {
                        next(0);
                    }
                }, cb, this),

                ibind(function(next) {
                    if (!this.polyfills) {
                        var polyfillsDirPath = path.join(__dirname, &#x27;..&#x27;, &#x27;client&#x27;, &#x27;polyfills&#x27;);
                        this.polyfills = {};
                        fs.readdir(polyfillsDirPath, abind(function(err, names) {
                            if (!err) {
                                _.each(names, ibind(function(name) {
                                    var feature = path.basename(name, &#x27;.js&#x27;);
                                    this.polyfills[feature] = true;
                                }, cb, this));
                            }
                            next(0, deps);
                        }, cb, this));
                    } else {
                        next(0);
                    }
                }, cb, this),
            ], abind(function(err, results) {
                cb(0, deps);
            }, cb, this));
        }, cb, this));
    } else {
        cb(0, this.dependencies);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.js.App.prototype.getContentScript" id="apidoc.element.app.js.js.App.prototype.getContentScript">
        function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype.getContentScript
        <span class="apidocSignatureSpan">(renderer, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">js.App.prototype.getContentScript = function (renderer, cb) {
    if (!this.contentScript) {
        this.loadURL(this.jsPath, renderer, {loader: &#x27;static&#x27;, js: &#x27;inline&#x27;, beautify: true},
        abind(function(err, js) {
            this.contentScript = vm.createScript(js.body, &#x27;document.js&#x27;);
            cb(0, this.contentScript);
        }, cb, this));
    } else {
        cb(0, this.contentScript);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.js.App.prototype.invalidate" id="apidoc.element.app.js.js.App.prototype.invalidate">
        function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype.invalidate
        <span class="apidocSignatureSpan">(dependentURL)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">js.App.prototype.invalidate = function (dependentURL) {
    delete this.contentScript;
    delete this.featureDB;
    delete this.dependencies;

    if (this.socketServer) {
        this.socketServer.broadcast(JSON.stringify({
            name: &#x27;invalidate&#x27;,
            URL: this.normalizeURL(dependentURL.url)
        }));
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.js.App.prototype.loadResources" id="apidoc.element.app.js.js.App.prototype.loadResources">
        function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype.loadResources
        <span class="apidocSignatureSpan">(req, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">js.App.prototype.loadResources = function (req, cb) {
    var options = readOptions(req, this);
    this._prepare(abind(function(err) {
        this.renderer.renderResources(options, cb);
    }, cb, this));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.js.App.prototype.loadURL" id="apidoc.element.app.js.js.App.prototype.loadURL">
        function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype.loadURL
        <span class="apidocSignatureSpan">(URL, renderer, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">js.App.prototype.loadURL = function (URL, renderer, options, cb) {
    var req = parseAppjsURL(this, URL, {});
    return this._loadURL(req.urlParsed, req.appjsParts, req.appjsMatch, renderer, options, cb)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.js.App.prototype.normalizeURL" id="apidoc.element.app.js.js.App.prototype.normalizeURL">
        function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype.normalizeURL
        <span class="apidocSignatureSpan">(URL, category, timestamp)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">js.App.prototype.normalizeURL = function (URL, category, timestamp) {
    return this.renderer.renderURL(URL, category, true, timestamp);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.js.App.prototype.reloadPage" id="apidoc.element.app.js.js.App.prototype.reloadPage">
        function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype.reloadPage
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">js.App.prototype.reloadPage = function () {
    if (this.socketServer) {
        this.socketServer.broadcast(JSON.stringify({
            name: &#x27;reload&#x27;
        }));
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.js.App.prototype.route" id="apidoc.element.app.js.js.App.prototype.route">
        function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype.route
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">js.App.prototype.route = function () {
    function handler(req, res, next) {
        var urlOptions = readOptions(req.query, this);
        if (isCrawler(req)) {
            urlOptions.content = &#x27;inline&#x27;;
        }
        urlOptions.userAgent = req.header(&#x27;user-agent&#x27;);

        // Note that the URL matching is done in the prepware middleware function
        this._loadURL(req.urlParsed, req.appjsParts, req.appjsMatch, this.renderer, urlOptions,
        function(err, result) {
            if (err) {
                dandy.logException(err);
                send(err, true);
            } else {
                send(result);
            }
        });

        function send(result, isError) {
            if (result.dependencies) {
                res.dependencies = _.pluck(result.dependencies, &#x27;path&#x27;);
            }

            var mimeType = result.mimeType || (result.path
                ? mime.lookup(result.path) || defaultMimeType
                : htmlMimeType);

            if (isTextMimeType(mimeType)) {
                mimeType += &#x27;; charset=UTF-8&#x27;
            }

            res.header(&#x27;Content-Type&#x27;, mimeType);

            if (!isError) {
                var latestTime = findLatestMtime(result.dependencies || []);
                if (latestTime) {
                    res.header(&#x27;ETag&#x27;, latestTime);
                }

                // if (result.permanent || isCDN(req)) {
                //     res.header(&#x27;Cache-Control&#x27;, &#x27;public, max-age=31536000&#x27;);
                // } else {
                    res.header(&#x27;Cache-Control&#x27;, &#x27;public, max-age=0&#x27;);
                // }
            }

            res.send(result.body, result.error || 200);
        }
    }

    if (this.cache) {
        this.cache.on(&#x27;unmonitor&#x27;, _.bind(function(URL) {
            this.invalidate(URL);
        }, this));
    }

    if (this.socket) {
        this._listenToSocket();
    }
    var cacheMiddleware = this.cache ? cacheware(this.cache) : noware;
    return [prepware(this), uaware(this), cacheMiddleware, _.bind(handler, this)];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.js.App.prototype.staticRoute" id="apidoc.element.app.js.js.App.prototype.staticRoute">
        function <span class="apidocSignatureSpan">app.js.</span>js.App.prototype.staticRoute
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">js.App.prototype.staticRoute = function () {
    function handler(req, res, next) {
        var filePath;
        if (!req.appjsMatch) {
            filePath = &#x27;index.html&#x27;;
        } else {
            filePath = req.appjsParts.slice(1).join(&#x27;/&#x27;);
        }

        filePath = path.join(this.repoPath, filePath);
        fs.stat(filePath, abind(function(err, stat) {
            var dependencies = [{path: filePath, mtime: stat.mtime.getTime()}];
            fs.readFile(filePath, abind(function(err, source) {
                send.call(this, {path: filePath, body: source, error: err}, !!err);
            }, next, this));
        }, next, this));

        function send(result, isError) {
            var mimeType = result.mimeType || (result.path
                ? mime.lookup(result.path) || defaultMimeType
                : htmlMimeType);

            if (isTextMimeType(mimeType)) {
                mimeType += &#x27;; charset=UTF-8&#x27;
            }

            res.header(&#x27;Content-Type&#x27;, mimeType);

            if (!isError) {
                res.header(&#x27;ETag&#x27;, this.appVersion);

                // if (result.permanent || isCDN(req)) {
                //     res.header(&#x27;Cache-Control&#x27;, &#x27;public, max-age=31536000&#x27;);
                // } else {
                    res.header(&#x27;Cache-Control&#x27;, &#x27;public, max-age=0&#x27;);
                // }
            }

            res.send(result.body, result.error || 200);
        }
    }

    if (this.cache) {
        this.cache.on(&#x27;unmonitor&#x27;, _.bind(function(URL) {
            this.invalidate(URL);
        }, this));
    }

    var cacheMiddleware = this.cache ? cacheware(this.cache) : noware;
    return [prepware(this), cacheMiddleware, _.bind(handler, this)];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.js.route" id="apidoc.element.app.js.js.route">
        function <span class="apidocSignatureSpan">app.js.</span>js.route
        <span class="apidocSignatureSpan">(conf)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">js.route = function (conf) {
    var app = new App(conf);
    return app.route();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.js.run" id="apidoc.element.app.js.js.run">
        function <span class="apidocSignatureSpan">app.js.</span>js.run
        <span class="apidocSignatureSpan">(argv)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">js.run = function (argv) {
    if (argv.pack) {
        process.env.NODE_ENV = &#x27;production&#x27;;
        process.env.APPJSPACK = true;
    }

    createServersFromConf(argv, function(err, servers) {
        if (err || !servers.length) {
            dandy.logException(&#x22;No sites loaded.&#x22;);
        } else {
            if (argv.pack) {
                var port = 8081;
                var server = getPackServer(servers, argv.pack);
                var httpServer = server.listen(port);

                if (server.appVersion) {
                    server.appVersion = incrementRepoVersion(server.appVersion);
                } else {
                    server.appVersion = &#x27;v0.0&#x27;;
                }

                console.log(&#x27;Creating version&#x27;, server.appVersion);

                saveRepoVersion(server.repoPath, server.appVersion);
                server.appjsApp.appVersion = server.appVersion;

                packServer(server, port, function(err) {
                    if (err) {
                        console.log(err);
                    } else {
                        console.log(&#x27;done.&#x27;);
                    }
                    process.exit(0);
                });
            } else {
                var port = argv.port || defaultPort;
                var server = getMainServer(servers, argv);
                server.listen(port);
                console.log(&#x22;App.js server listening on port %d (%s)&#x22;, server.address().port,
                            new Date());
            }
        }
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.js.searchScript" id="apidoc.element.app.js.js.searchScript">
        function <span class="apidocSignatureSpan">app.js.</span>js.searchScript
        <span class="apidocSignatureSpan">(modulePath, searchPaths, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">js.searchScript = function (modulePath, searchPaths, cb) {
    if (typeof(searchPaths) == &#x27;function&#x27;) { cb = searchPaths; searchPaths = null; }

    if (!(searchPaths instanceof Array)) {
        searchPaths = [searchPaths];
    } else {
        searchPaths = searchPaths.slice();
        searchPaths.push(null);
    }

    if (process.env.NODE_PATH) {
        searchPaths.push.apply(searchPaths, process.env.NODE_PATH.split(&#x27;;&#x27;));
    }

    if (modulePath[0] == &#x27;/&#x27;) {
        complete(modulePath);
    } else {
        searchBasePath(searchPaths.shift());
    }

    function searchBasePath(basePath) {
        var baseScriptPath;
        if (basePath) {
            try {
                baseScriptPath = path.dirname(require.resolve(basePath));
            } catch (exc) {
                baseScriptPath = basePath;
            }
        }
        if (baseScriptPath) {
            var absolutePath = path.resolve(baseScriptPath, modulePath);
            try {
                var scriptPath = require.resolve(absolutePath);
                return complete(scriptPath);
            } catch (exc) {

            }
        }

        if (baseScriptPath) {
            var baseDir = baseScriptPath;
            findInNodeModules(baseDir);
        } else {
            complete(modulePath);
        }
    }

<span class="apidocCodeCommentSpan">    /**
     * require.resolve unfortunately can&#x27;t be given a relative base path, so we have
     * to simulate its behavior ourself.  This here does the node_modules search.
     */
</span>    function findInNodeModules(containerPath) {
        fs.stat(containerPath, abind(function(err, stat) {
            if (stat.isDirectory()) {
                var foundPath = path.resolve(containerPath, &#x27;node_modules&#x27;, modulePath);
                try {
                    foundPath = require.resolve(foundPath);
                    complete(foundPath);
                } catch (exc) {
                    if (containerPath != &#x27;/&#x27;) {
                        findInNodeModules(path.dirname(containerPath));
                    } else {
                        tryNext();
                    }
                }
            } else {
                tryNext();
            }
        }, fail, this));
    }

    function complete(foundPath) {
        try {
            var scriptPath = require.resolve(foundPath);
            exports.shortenModulePath(scriptPath, abind(function(err, shortModulePath) {
                cb(0, {path: scriptPath, name: shortModulePath});
            }, fail, this));
        } catch (exc) {
            fail();
        }
    }

    function tryNext() {
        if (!searchPaths.length) {
            fail();
        } else {
            var nextPath = searchPaths.shift();
            searchBasePath(nextPath);
        }
    }

    function fail() {
        cb(new Error(&#x22;Module &#x27;&#x22; + modulePath + &#x22;&#x27; not found.&#x22;));
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.js.searchStatic" id="apidoc.element.app.js.js.searchStatic">
        function <span class="apidocSignatureSpan">app.js.</span>js.searchStatic
        <span class="apidocSignatureSpan">(modulePath, searchPaths, isURL, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">js.searchStatic = function (modulePath, searchPaths, isURL, cb) {
    if (typeof(isURL) == &#x27;function&#x27;) { cb = isURL; isURL = false; }
    if (typeof(searchPaths) == &#x27;function&#x27;) { cb = searchPaths; searchPaths = null; }

    modulePath = securePath(modulePath);
    if (!modulePath) { cb(&#x22;Illegal path&#x22;); return; }

    findBasePath(abind(function(err, basePath) {
        try {
            var parts = modulePath.split(&#x27;/&#x27;);
            if (!parts.length) {
                cb(0, &#x27;&#x27;);
            }

            exports.findPackageStaticPath(basePath, abind(function(err, staticPath) {
                var filePath = path.join(staticPath, parts.slice(1).join(&#x27;/&#x27;));
                cb(0, filePath);
            }, cb, this));
        } catch (exc) {
            console.error(exc.stack)
            cb(exc);
        }
    }, cb, this));

    function findBasePath(cb) {
        if (modulePath[0] == &#x27;.&#x27;) {
            cb(0, searchPaths[0]);
        } else {
            var baseModule = modulePath.split(&#x27;/&#x27;)[0];
            exports.searchScript(baseModule, searchPaths, abind(function(err, findings) {
                if (isURL) {
                    cb(0, findings.path);
                } else {
                    cb(0, findings.path);
                }
            }, cb, this));
        }
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.js.shortenStaticPath" id="apidoc.element.app.js.js.shortenStaticPath">
        function <span class="apidocSignatureSpan">app.js.</span>js.shortenStaticPath
        <span class="apidocSignatureSpan">(resourcePath, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">js.shortenStaticPath = function (resourcePath, cb) {
    exports.findPackageInfo(resourcePath, abind(function(err, result) {
        var staticPath = readStaticPath(result);
        if (staticPath) {
            // Remove the directories above the package directory
            var relativePath = resourcePath.substr(staticPath.length+1);
            var relativeName = path.join(result.info.name, relativePath);
            cb(0, relativeName);
        } else {
            cb(0, null);
        }
    }, cb, this));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.route" id="apidoc.element.app.js.route">
        function <span class="apidocSignatureSpan">app.js.</span>route
        <span class="apidocSignatureSpan">(conf)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">route = function (conf) {
    var app = new App(conf);
    return app.route();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.run" id="apidoc.element.app.js.run">
        function <span class="apidocSignatureSpan">app.js.</span>run
        <span class="apidocSignatureSpan">(argv)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">run = function (argv) {
    if (argv.pack) {
        process.env.NODE_ENV = &#x27;production&#x27;;
        process.env.APPJSPACK = true;
    }

    createServersFromConf(argv, function(err, servers) {
        if (err || !servers.length) {
            dandy.logException(&#x22;No sites loaded.&#x22;);
        } else {
            if (argv.pack) {
                var port = 8081;
                var server = getPackServer(servers, argv.pack);
                var httpServer = server.listen(port);

                if (server.appVersion) {
                    server.appVersion = incrementRepoVersion(server.appVersion);
                } else {
                    server.appVersion = &#x27;v0.0&#x27;;
                }

                console.log(&#x27;Creating version&#x27;, server.appVersion);

                saveRepoVersion(server.repoPath, server.appVersion);
                server.appjsApp.appVersion = server.appVersion;

                packServer(server, port, function(err) {
                    if (err) {
                        console.log(err);
                    } else {
                        console.log(&#x27;done.&#x27;);
                    }
                    process.exit(0);
                });
            } else {
                var port = argv.port || defaultPort;
                var server = getMainServer(servers, argv);
                server.listen(port);
                console.log(&#x22;App.js server listening on port %d (%s)&#x22;, server.address().port,
                            new Date());
            }
        }
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.searchScript" id="apidoc.element.app.js.searchScript">
        function <span class="apidocSignatureSpan">app.js.</span>searchScript
        <span class="apidocSignatureSpan">(modulePath, searchPaths, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">searchScript = function (modulePath, searchPaths, cb) {
    if (typeof(searchPaths) == &#x27;function&#x27;) { cb = searchPaths; searchPaths = null; }

    if (!(searchPaths instanceof Array)) {
        searchPaths = [searchPaths];
    } else {
        searchPaths = searchPaths.slice();
        searchPaths.push(null);
    }

    if (process.env.NODE_PATH) {
        searchPaths.push.apply(searchPaths, process.env.NODE_PATH.split(&#x27;;&#x27;));
    }

    if (modulePath[0] == &#x27;/&#x27;) {
        complete(modulePath);
    } else {
        searchBasePath(searchPaths.shift());
    }

    function searchBasePath(basePath) {
        var baseScriptPath;
        if (basePath) {
            try {
                baseScriptPath = path.dirname(require.resolve(basePath));
            } catch (exc) {
                baseScriptPath = basePath;
            }
        }
        if (baseScriptPath) {
            var absolutePath = path.resolve(baseScriptPath, modulePath);
            try {
                var scriptPath = require.resolve(absolutePath);
                return complete(scriptPath);
            } catch (exc) {

            }
        }

        if (baseScriptPath) {
            var baseDir = baseScriptPath;
            findInNodeModules(baseDir);
        } else {
            complete(modulePath);
        }
    }

<span class="apidocCodeCommentSpan">    /**
     * require.resolve unfortunately can&#x27;t be given a relative base path, so we have
     * to simulate its behavior ourself.  This here does the node_modules search.
     */
</span>    function findInNodeModules(containerPath) {
        fs.stat(containerPath, abind(function(err, stat) {
            if (stat.isDirectory()) {
                var foundPath = path.resolve(containerPath, &#x27;node_modules&#x27;, modulePath);
                try {
                    foundPath = require.resolve(foundPath);
                    complete(foundPath);
                } catch (exc) {
                    if (containerPath != &#x27;/&#x27;) {
                        findInNodeModules(path.dirname(containerPath));
                    } else {
                        tryNext();
                    }
                }
            } else {
                tryNext();
            }
        }, fail, this));
    }

    function complete(foundPath) {
        try {
            var scriptPath = require.resolve(foundPath);
            exports.shortenModulePath(scriptPath, abind(function(err, shortModulePath) {
                cb(0, {path: scriptPath, name: shortModulePath});
            }, fail, this));
        } catch (exc) {
            fail();
        }
    }

    function tryNext() {
        if (!searchPaths.length) {
            fail();
        } else {
            var nextPath = searchPaths.shift();
            searchBasePath(nextPath);
        }
    }

    function fail() {
        cb(new Error(&#x22;Module &#x27;&#x22; + modulePath + &#x22;&#x27; not found.&#x22;));
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var basePath = scriptPath == this.client ? null : this.client;

var searchPaths = [basePath];
if (this.paths.length) {
    searchPaths.push.apply(searchPaths, this.paths);
}

pkg.<span class="apidocCodeKeywordSpan">searchScript</span>(scriptPath, searchPaths, abind(function(err, findings) {
    if (findings) {
        renderer.renderScript(findings.path, findings.name, options, true,
            abind(function(err, result) {
                cb(0, {path: findings.path, name: findings.name, body: result.source,
                       dependencies: result.dependencies, permanent: true});
            }, cb)
        );
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.searchStatic" id="apidoc.element.app.js.searchStatic">
        function <span class="apidocSignatureSpan">app.js.</span>searchStatic
        <span class="apidocSignatureSpan">(modulePath, searchPaths, isURL, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">searchStatic = function (modulePath, searchPaths, isURL, cb) {
    if (typeof(isURL) == &#x27;function&#x27;) { cb = isURL; isURL = false; }
    if (typeof(searchPaths) == &#x27;function&#x27;) { cb = searchPaths; searchPaths = null; }

    modulePath = securePath(modulePath);
    if (!modulePath) { cb(&#x22;Illegal path&#x22;); return; }

    findBasePath(abind(function(err, basePath) {
        try {
            var parts = modulePath.split(&#x27;/&#x27;);
            if (!parts.length) {
                cb(0, &#x27;&#x27;);
            }

            exports.findPackageStaticPath(basePath, abind(function(err, staticPath) {
                var filePath = path.join(staticPath, parts.slice(1).join(&#x27;/&#x27;));
                cb(0, filePath);
            }, cb, this));
        } catch (exc) {
            console.error(exc.stack)
            cb(exc);
        }
    }, cb, this));

    function findBasePath(cb) {
        if (modulePath[0] == &#x27;.&#x27;) {
            cb(0, searchPaths[0]);
        } else {
            var baseModule = modulePath.split(&#x27;/&#x27;)[0];
            exports.searchScript(baseModule, searchPaths, abind(function(err, findings) {
                if (isURL) {
                    cb(0, findings.path);
                } else {
                    cb(0, findings.path);
                }
            }, cb, this));
        }
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
            permanent: options.js == &#x22;inline&#x22; &#x26;&#x26; options.css == &#x22;inline&#x22;,
            dependencies: result.dependencies,
        });
    }, cb));
},

_loadStatic: function(staticPath, renderer, options, cb) {
    pkg.<span class="apidocCodeKeywordSpan">searchStatic</span>(staticPath, this.paths, abind(function(err, filePath) {
        if (filePath) {
            fs.stat(filePath, abind(function(err, stat) {
                var dependencies = [{path: filePath, mtime: stat.mtime.getTime()}];
                fs.readFile(filePath, abind(function(err, source) {
                    if (mime.lookup(filePath) == &#x27;text/css&#x27;) {
                        renderer.compressCSS(source+&#x27;&#x27;, staticPath, options,
                        function(err, source) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.shortenStaticPath" id="apidoc.element.app.js.shortenStaticPath">
        function <span class="apidocSignatureSpan">app.js.</span>shortenStaticPath
        <span class="apidocSignatureSpan">(resourcePath, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">shortenStaticPath = function (resourcePath, cb) {
    exports.findPackageInfo(resourcePath, abind(function(err, result) {
        var staticPath = readStaticPath(result);
        if (staticPath) {
            // Remove the directories above the package directory
            var relativePath = resourcePath.substr(staticPath.length+1);
            var relativeName = path.join(result.info.name, relativePath);
            cb(0, relativeName);
        } else {
            cb(0, null);
        }
    }, cb, this));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                if (err) { if (!--depth) cb(0, results); return; }
                fs.stat(stylesheetPath, _.bind(function(err, stat) {
                    if (err) { if (!--depth) cb(0, results); return; }

                    fs.readFile(stylesheetPath, _.bind(function(err, source) {
                        if (err) { if (!--depth) cb(0, results); return; }

                        exports.<span class="apidocCodeKeywordSpan">shortenStaticPath</span>(stylesheetPath, _.bind(function(err
, absolutePath) {
if (err) { if (!--depth) cb(0, results); return; }

styleMap[absolutePath] = {
    path: stylesheetPath,
    sourceURL: sourceURL,
    sourceLine: sourceLine,
    mtime: stat.mtime.getTime()
...</pre></li>
    </ul>










</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.app.js.App" id="apidoc.module.app.js.App">module app.js.App</a></h1>


    <h2>
        <a href="#apidoc.element.app.js.App.App" id="apidoc.element.app.js.App.App">
        function <span class="apidocSignatureSpan">app.js.</span>App
        <span class="apidocSignatureSpan">(conf)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function App(conf) {
    this.paths = process.env.NODE_PATH ? process.env.NODE_PATH.split(&#x27;;&#x27;) : [];

    this._assignConfig(conf);

    if (this.repo) {
        this.repo = this.repo.replace(/^~/, process.env.HOME);
    }

    this.base = addTrailingSlash(this.base);
    this.baseLength = this.base.split(&#x22;/&#x22;).length-2;
    this.startupTime = new Date().getTime();

    this.renderer = new Renderer(this, this.api, this.apiCache, this.base);

    if (!this.cache) {
        this.cache = new Cache(null, false, true, true);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.app.js.App.prototype" id="apidoc.module.app.js.App.prototype">module app.js.App.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.app.js.App.prototype._assignConfig" id="apidoc.element.app.js.App.prototype._assignConfig">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_assignConfig
        <span class="apidocSignatureSpan">(conf)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_assignConfig = function (conf) {
    for (var name in defaults) {
        if (name == &#x22;configs&#x22;) {
            var branch = process.env.NODE_ENV == &#x22;production&#x22;
                         ? defaults.configs.production
                         : defaults.configs.development;
            for (var name in branch) {
                this[name] = name in conf ? conf[name] : branch[name];
            }
        } else {
            this[name] = name in conf ? conf[name] : defaults[name];
        }
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var reRootFiles = /(robots\.txt)|(favicon\.ico)|(apple-touch-icon(.*?)\.png)/;

// *************************************************************************************************

function App(conf) {
this.paths = process.env.NODE_PATH ? process.env.NODE_PATH.split(&#x27;;&#x27;) : [];

this.<span class="apidocCodeKeywordSpan">_assignConfig</span>(conf);

if (this.repo) {
    this.repo = this.repo.replace(/^~/, process.env.HOME);
}

this.base = addTrailingSlash(this.base);
this.baseLength = this.base.split(&#x22;/&#x22;).length-2;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.App.prototype._cleanJSPath" id="apidoc.element.app.js.App.prototype._cleanJSPath">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_cleanJSPath
        <span class="apidocSignatureSpan">(jsPath, renderer)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_cleanJSPath = function (jsPath, renderer) {
    return jsPath
        ? path.join(path.dirname(jsPath), path.basename(jsPath, &#x27;.js&#x27;))
        : this.client;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
            }, cb, this));
        }, cb, this));
    }
}, cb, this));
    },

    _loadJS: function(modulePath, renderer, options, cb) {
var scriptPath = this.<span class="apidocCodeKeywordSpan">_cleanJSPath</span>(modulePath, renderer);
var basePath = scriptPath == this.client ? null : this.client;

var searchPaths = [basePath];
if (this.paths.length) {
    searchPaths.push.apply(searchPaths, this.paths);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.App.prototype._listenToSocket" id="apidoc.element.app.js.App.prototype._listenToSocket">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_listenToSocket
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_listenToSocket = function () {
    var u = url.parse(&#x27;ws://&#x27; + this.socket);
    var ws = require(&#x22;websocket-server&#x22;);
    this.socketServer = ws.createServer();
    this.socketServer.listen(u.port);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    if (this.cache) {
        this.cache.on(&#x27;unmonitor&#x27;, _.bind(function(URL) {
            this.invalidate(URL);
        }, this));
    }

    if (this.socket) {
        this.<span class="apidocCodeKeywordSpan">_listenToSocket</span>();
    }
    var cacheMiddleware = this.cache ? cacheware(this.cache) : noware;
    return [prepware(this), uaware(this), cacheMiddleware, _.bind(handler, this)];
},

staticRoute: function() {
    function handler(req, res, next) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.App.prototype._loadAppcache" id="apidoc.element.app.js.App.prototype._loadAppcache">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadAppcache
        <span class="apidocSignatureSpan">(renderer, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_loadAppcache = function (renderer, options, cb) {
    renderer.renderAppcache(options,
        abind(function(err, result) {
            cb(0, {
                body: result.source,
                mimeType: &#x27;text/cache-manifest&#x27;,
                permanent: options.js == &#x22;inline&#x22; &#x26;&#x26; options.css == &#x22;inline&#x22;
            });
        }, cb)
    );
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        options.js = &#x27;source&#x27;;
        options.css = &#x27;included&#x27;;
    }
    this._loadJS(parts.slice(3).join(&#x27;/&#x27;), renderer, options, cb);
} else if (parts[2] == &#x27;css&#x27;) {
    this._loadCSS(renderer, options, cb);
} else if (parts[2] == &#x27;cache.manifest&#x27;) {
    this.<span class="apidocCodeKeywordSpan">_loadAppcache</span>(renderer, options, cb);
} else if (parts[2] == &#x27;has&#x27;) {
    this._loadHas(renderer, options, cb);
} else if (parts[2] == &#x27;polyfills&#x27;) {
    this._loadPolyfills(renderer, options, cb);
} else {
    cb(&#x22;Not found&#x22;);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.App.prototype._loadAppjs" id="apidoc.element.app.js.App.prototype._loadAppjs">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadAppjs
        <span class="apidocSignatureSpan">(renderer, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_loadAppjs = function (renderer, options, cb) {
    var scriptName;
    if (options.loader == &#x22;static&#x22; || options.js == &#x22;worker&#x22;) {
        scriptName = &#x22;appjs-static.js&#x22;;
    } else if (options.loader == &#x22;dynamic&#x22;) {
        scriptName = &#x22;appjs-dynamic.js&#x22;;
    } else if (options.loader == &#x22;standalone&#x22;) {
        scriptName = &#x22;appjs-standalone.js&#x22;;
    }
    if (scriptName) {
        var appjsPath = path.resolve(__dirname, &#x27;..&#x27;, &#x27;client&#x27;, scriptName);
        renderer.renderScriptRaw(appjsPath, &#x27;&#x27;, options,
            abind(function(err, result) {
                cb(0, {path: appjsPath, body: result.source, dependencies: result.dependencies});
            }, cb)
        );
    } else {
        cb(new Error(&#x22;Loader unspecified&#x22;));
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        this.renderer.renderResources(options, cb);
    }, cb, this));
},

_loadURL: function(urlParsed, parts, m, renderer, options, cb) {
    if (m) {
        if (parts.length == 2) {
            this.<span class="apidocCodeKeywordSpan">_loadAppjs</span>(renderer, options, cb);
        } else {
            if (parts[2] == &#x27;static&#x27;) {
                this._loadStatic(parts.slice(3).join(&#x27;/&#x27;), renderer, options, cb);
            } else if (parts[2] == &#x27;js&#x27;) {
                var userAgent = m[2] ? unescape(m[2].substr(1)) : &#x27;&#x27;;
                if (userAgent) {
                    options.userAgent = userAgent;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.App.prototype._loadCSS" id="apidoc.element.app.js.App.prototype._loadCSS">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadCSS
        <span class="apidocSignatureSpan">(renderer, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_loadCSS = function (renderer, options, cb) {
    renderer.renderStylesheet(options,
        abind(function(err, result) {
            cb(0, {path: result.path, body: result.source, dependencies: result.dependencies,
                   permanent: true});
        }, cb)
    );
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

    if (parts.length &#x3e; 3) {
        options.js = &#x27;source&#x27;;
        options.css = &#x27;included&#x27;;
    }
    this._loadJS(parts.slice(3).join(&#x27;/&#x27;), renderer, options, cb);
} else if (parts[2] == &#x27;css&#x27;) {
    this.<span class="apidocCodeKeywordSpan">_loadCSS</span>(renderer, options, cb);
} else if (parts[2] == &#x27;cache.manifest&#x27;) {
    this._loadAppcache(renderer, options, cb);
} else if (parts[2] == &#x27;has&#x27;) {
    this._loadHas(renderer, options, cb);
} else if (parts[2] == &#x27;polyfills&#x27;) {
    this._loadPolyfills(renderer, options, cb);
} else {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.App.prototype._loadHas" id="apidoc.element.app.js.App.prototype._loadHas">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadHas
        <span class="apidocSignatureSpan">(renderer, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_loadHas = function (renderer, options, cb) {
    renderer.renderHas(options, abind(function(err, result) {
        cb(0, {path: result.path, body: result.source, dependencies: result.dependencies});
    }, cb));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
            }
            this._loadJS(parts.slice(3).join(&#x27;/&#x27;), renderer, options, cb);
        } else if (parts[2] == &#x27;css&#x27;) {
            this._loadCSS(renderer, options, cb);
        } else if (parts[2] == &#x27;cache.manifest&#x27;) {
            this._loadAppcache(renderer, options, cb);
        } else if (parts[2] == &#x27;has&#x27;) {
            this.<span class="apidocCodeKeywordSpan">_loadHas</span>(renderer, options, cb);
        } else if (parts[2] == &#x27;polyfills&#x27;) {
            this._loadPolyfills(renderer, options, cb);
        } else {
            cb(&#x22;Not found&#x22;);
        }
    }
} else if (reRootFiles.exec(parts[1])) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.App.prototype._loadJS" id="apidoc.element.app.js.App.prototype._loadJS">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadJS
        <span class="apidocSignatureSpan">(modulePath, renderer, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_loadJS = function (modulePath, renderer, options, cb) {
    var scriptPath = this._cleanJSPath(modulePath, renderer);
    var basePath = scriptPath == this.client ? null : this.client;

    var searchPaths = [basePath];
    if (this.paths.length) {
        searchPaths.push.apply(searchPaths, this.paths);
    }

    pkg.searchScript(scriptPath, searchPaths, abind(function(err, findings) {
        if (findings) {
            renderer.renderScript(findings.path, findings.name, options, true,
                abind(function(err, result) {
                    cb(0, {path: findings.path, name: findings.name, body: result.source,
                           dependencies: result.dependencies, permanent: true});
                }, cb)
            );
        }
    }, cb, this));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        options.userAgent = userAgent;
    }

    if (parts.length &#x3e; 3) {
        options.js = &#x27;source&#x27;;
        options.css = &#x27;included&#x27;;
    }
    this.<span class="apidocCodeKeywordSpan">_loadJS</span>(parts.slice(3).join(&#x27;/&#x27;), renderer, options, cb);
} else if (parts[2] == &#x27;css&#x27;) {
    this._loadCSS(renderer, options, cb);
} else if (parts[2] == &#x27;cache.manifest&#x27;) {
    this._loadAppcache(renderer, options, cb);
} else if (parts[2] == &#x27;has&#x27;) {
    this._loadHas(renderer, options, cb);
} else if (parts[2] == &#x27;polyfills&#x27;) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.App.prototype._loadPage" id="apidoc.element.app.js.App.prototype._loadPage">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadPage
        <span class="apidocSignatureSpan">(URL, renderer, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_loadPage = function (URL, renderer, options, cb) {
    renderer.renderPage(URL, options, abind(function(err, result) {
        cb(0, {
            body: result.source,
            permanent: options.js == &#x22;inline&#x22; &#x26;&#x26; options.css == &#x22;inline&#x22;,
            dependencies: result.dependencies,
        });
    }, cb));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                cb(&#x22;Not found&#x22;);
            }
        }
    } else if (reRootFiles.exec(parts[1])) {
        var newURL = this.staticPath + &#x27;/&#x27; + this.packageName + &#x27;/&#x27; + parts[1];
        this.loadURL(newURL, renderer, options, cb);
    } else {
        this.<span class="apidocCodeKeywordSpan">_loadPage</span>(urlParsed, renderer, options, cb);
    }
},

getContentScript: function(renderer, cb) {
    if (!this.contentScript) {
        this.loadURL(this.jsPath, renderer, {loader: &#x27;static&#x27;, js: &#x27;inline&#x27;, beautify: true},
        abind(function(err, js) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.App.prototype._loadPolyfills" id="apidoc.element.app.js.App.prototype._loadPolyfills">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadPolyfills
        <span class="apidocSignatureSpan">(renderer, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_loadPolyfills = function (renderer, options, cb) {
    renderer.renderPolyfills(options, abind(function(err, result) {
        cb(0, {path: result.path, body: result.source, dependencies: result.dependencies});
    }, cb));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        } else if (parts[2] == &#x27;css&#x27;) {
            this._loadCSS(renderer, options, cb);
        } else if (parts[2] == &#x27;cache.manifest&#x27;) {
            this._loadAppcache(renderer, options, cb);
        } else if (parts[2] == &#x27;has&#x27;) {
            this._loadHas(renderer, options, cb);
        } else if (parts[2] == &#x27;polyfills&#x27;) {
            this.<span class="apidocCodeKeywordSpan">_loadPolyfills</span>(renderer, options, cb);
        } else {
            cb(&#x22;Not found&#x22;);
        }
    }
} else if (reRootFiles.exec(parts[1])) {
    var newURL = this.staticPath + &#x27;/&#x27; + this.packageName + &#x27;/&#x27; + parts[1];
    this.loadURL(newURL, renderer, options, cb);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.App.prototype._loadStatic" id="apidoc.element.app.js.App.prototype._loadStatic">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadStatic
        <span class="apidocSignatureSpan">(staticPath, renderer, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_loadStatic = function (staticPath, renderer, options, cb) {
    pkg.searchStatic(staticPath, this.paths, abind(function(err, filePath) {
        if (filePath) {
            fs.stat(filePath, abind(function(err, stat) {
                var dependencies = [{path: filePath, mtime: stat.mtime.getTime()}];
                fs.readFile(filePath, abind(function(err, source) {
                    if (mime.lookup(filePath) == &#x27;text/css&#x27;) {
                        renderer.compressCSS(source+&#x27;&#x27;, staticPath, options,
                        function(err, source) {
                            cb(0, {path: filePath, body: source, dependencies: dependencies});
                        });
                    } else {
                        cb(0, {path: filePath, body: source, raw: true,
                               dependencies: dependencies});
                    }
                }, cb, this));
            }, cb, this));
        }
    }, cb, this));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

    _loadURL: function(urlParsed, parts, m, renderer, options, cb) {
        if (m) {
            if (parts.length == 2) {
                this._loadAppjs(renderer, options, cb);
            } else {
                if (parts[2] == &#x27;static&#x27;) {
this.<span class="apidocCodeKeywordSpan">_loadStatic</span>(parts.slice(3).join(&#x27;/&#x27;), renderer, options, cb);
                } else if (parts[2] == &#x27;js&#x27;) {
var userAgent = m[2] ? unescape(m[2].substr(1)) : &#x27;&#x27;;
if (userAgent) {
    options.userAgent = userAgent;
}

if (parts.length &#x3e; 3) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.App.prototype._loadURL" id="apidoc.element.app.js.App.prototype._loadURL">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadURL
        <span class="apidocSignatureSpan">(urlParsed, parts, m, renderer, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_loadURL = function (urlParsed, parts, m, renderer, options, cb) {
    if (m) {
        if (parts.length == 2) {
            this._loadAppjs(renderer, options, cb);
        } else {
            if (parts[2] == &#x27;static&#x27;) {
                this._loadStatic(parts.slice(3).join(&#x27;/&#x27;), renderer, options, cb);
            } else if (parts[2] == &#x27;js&#x27;) {
                var userAgent = m[2] ? unescape(m[2].substr(1)) : &#x27;&#x27;;
                if (userAgent) {
                    options.userAgent = userAgent;
                }

                if (parts.length &#x3e; 3) {
                    options.js = &#x27;source&#x27;;
                    options.css = &#x27;included&#x27;;
                }
                this._loadJS(parts.slice(3).join(&#x27;/&#x27;), renderer, options, cb);
            } else if (parts[2] == &#x27;css&#x27;) {
                this._loadCSS(renderer, options, cb);
            } else if (parts[2] == &#x27;cache.manifest&#x27;) {
                this._loadAppcache(renderer, options, cb);
            } else if (parts[2] == &#x27;has&#x27;) {
                this._loadHas(renderer, options, cb);
            } else if (parts[2] == &#x27;polyfills&#x27;) {
                this._loadPolyfills(renderer, options, cb);
            } else {
                cb(&#x22;Not found&#x22;);
            }
        }
    } else if (reRootFiles.exec(parts[1])) {
        var newURL = this.staticPath + &#x27;/&#x27; + this.packageName + &#x27;/&#x27; + parts[1];
        this.loadURL(newURL, renderer, options, cb);
    } else {
        this._loadPage(urlParsed, renderer, options, cb);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var urlOptions = readOptions(req.query, this);
if (isCrawler(req)) {
    urlOptions.content = &#x27;inline&#x27;;
}
urlOptions.userAgent = req.header(&#x27;user-agent&#x27;);

// Note that the URL matching is done in the prepware middleware function
this.<span class="apidocCodeKeywordSpan">_loadURL</span>(req.urlParsed, req.appjsParts, req.appjsMatch, this.renderer, urlOptions
,
function(err, result) {
    if (err) {
        dandy.logException(err);
        send(err, true);
    } else {
        send(result);
    }
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.App.prototype._prepare" id="apidoc.element.app.js.App.prototype._prepare">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_prepare
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_prepare = function (cb) {
    if (!this.dependencies) {
        var searchPaths = this.paths;
        pkg.traceScript(this.client, this.paths, false, abind(function(err, deps) {
            this.dependencies = deps;

            async.parallel([
                ibind(function(next) {
                    hascan.getFeatureDB(_.keys(deps.has), abind(function(err, featureDB) {
                        this.featureDB = featureDB;
                        next(0);
                    }, next, this));
                }, cb, this),

                ibind(function(next) {
                    if (!this.packageName) {
                        pkg.searchScript(this.client, searchPaths, abind(function(err, findings) {
                            pkg.findPackageInfo(findings.path, abind(function(err, result) {
                                this.packageName = result.info.name;
                                next(0);
                            }, cb, this));
                        }, cb, this));
                    } else {
                        next(0);
                    }
                }, cb, this),

                ibind(function(next) {
                    if (!this.polyfills) {
                        var polyfillsDirPath = path.join(__dirname, &#x27;..&#x27;, &#x27;client&#x27;, &#x27;polyfills&#x27;);
                        this.polyfills = {};
                        fs.readdir(polyfillsDirPath, abind(function(err, names) {
                            if (!err) {
                                _.each(names, ibind(function(name) {
                                    var feature = path.basename(name, &#x27;.js&#x27;);
                                    this.polyfills[feature] = true;
                                }, cb, this));
                            }
                            next(0, deps);
                        }, cb, this));
                    } else {
                        next(0);
                    }
                }, cb, this),
            ], abind(function(err, results) {
                cb(0, deps);
            }, cb, this));
        }, cb, this));
    } else {
        cb(0, this.dependencies);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
loadURL: function(URL, renderer, options, cb) {
    var req = parseAppjsURL(this, URL, {});
    return this._loadURL(req.urlParsed, req.appjsParts, req.appjsMatch, renderer, options, cb)
},

loadResources: function(req, cb) {
    var options = readOptions(req, this);
    this.<span class="apidocCodeKeywordSpan">_prepare</span>(abind(function(err) {
        this.renderer.renderResources(options, cb);
    }, cb, this));
},

_loadURL: function(urlParsed, parts, m, renderer, options, cb) {
    if (m) {
        if (parts.length == 2) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.App.prototype.getContentScript" id="apidoc.element.app.js.App.prototype.getContentScript">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>getContentScript
        <span class="apidocSignatureSpan">(renderer, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getContentScript = function (renderer, cb) {
    if (!this.contentScript) {
        this.loadURL(this.jsPath, renderer, {loader: &#x27;static&#x27;, js: &#x27;inline&#x27;, beautify: true},
        abind(function(err, js) {
            this.contentScript = vm.createScript(js.body, &#x27;document.js&#x27;);
            cb(0, this.contentScript);
        }, cb, this));
    } else {
        cb(0, this.contentScript);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

        ].join(&#x27;\n&#x27;)
    });
},

renderContent: function(URL, html, options, cb) {
    if (options.content == &#x22;inline&#x22;) {
        this.app.<span class="apidocCodeKeywordSpan">getContentScript</span>(this, abind(function(err, script) {
            this._runInSandbox(script, URL, html, cb);
        }, cb, this));
    } else {
        cb(0, html);
    }
},
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.App.prototype.invalidate" id="apidoc.element.app.js.App.prototype.invalidate">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>invalidate
        <span class="apidocSignatureSpan">(dependentURL)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">invalidate = function (dependentURL) {
    delete this.contentScript;
    delete this.featureDB;
    delete this.dependencies;

    if (this.socketServer) {
        this.socketServer.broadcast(JSON.stringify({
            name: &#x27;invalidate&#x27;,
            URL: this.normalizeURL(dependentURL.url)
        }));
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

        res.send(result.body, result.error || 200);
    }
}

if (this.cache) {
    this.cache.on(&#x27;unmonitor&#x27;, _.bind(function(URL) {
        this.<span class="apidocCodeKeywordSpan">invalidate</span>(URL);
    }, this));
}

if (this.socket) {
    this._listenToSocket();
}
var cacheMiddleware = this.cache ? cacheware(this.cache) : noware;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.App.prototype.loadResources" id="apidoc.element.app.js.App.prototype.loadResources">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>loadResources
        <span class="apidocSignatureSpan">(req, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">loadResources = function (req, cb) {
    var options = readOptions(req, this);
    this._prepare(abind(function(err) {
        this.renderer.renderResources(options, cb);
    }, cb, this));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.App.prototype.loadURL" id="apidoc.element.app.js.App.prototype.loadURL">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>loadURL
        <span class="apidocSignatureSpan">(URL, renderer, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">loadURL = function (URL, renderer, options, cb) {
    var req = parseAppjsURL(this, URL, {});
    return this._loadURL(req.urlParsed, req.appjsParts, req.appjsMatch, renderer, options, cb)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                this._loadPolyfills(renderer, options, cb);
            } else {
                cb(&#x22;Not found&#x22;);
            }
        }
    } else if (reRootFiles.exec(parts[1])) {
        var newURL = this.staticPath + &#x27;/&#x27; + this.packageName + &#x27;/&#x27; + parts[1];
        this.<span class="apidocCodeKeywordSpan">loadURL</span>(newURL, renderer, options, cb);
    } else {
        this._loadPage(urlParsed, renderer, options, cb);
    }
},

getContentScript: function(renderer, cb) {
    if (!this.contentScript) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.App.prototype.normalizeURL" id="apidoc.element.app.js.App.prototype.normalizeURL">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>normalizeURL
        <span class="apidocSignatureSpan">(URL, category, timestamp)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">normalizeURL = function (URL, category, timestamp) {
    return this.renderer.renderURL(URL, category, true, timestamp);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    delete this.contentScript;
    delete this.featureDB;
    delete this.dependencies;

    if (this.socketServer) {
        this.socketServer.broadcast(JSON.stringify({
            name: &#x27;invalidate&#x27;,
            URL: this.<span class="apidocCodeKeywordSpan">normalizeURL</span>(dependentURL.url)
        }));
    }
},

reloadPage: function() {
    if (this.socketServer) {
        this.socketServer.broadcast(JSON.stringify({
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.App.prototype.reloadPage" id="apidoc.element.app.js.App.prototype.reloadPage">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>reloadPage
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">reloadPage = function () {
    if (this.socketServer) {
        this.socketServer.broadcast(JSON.stringify({
            name: &#x27;reload&#x27;
        }));
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.App.prototype.route" id="apidoc.element.app.js.App.prototype.route">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>route
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">route = function () {
    function handler(req, res, next) {
        var urlOptions = readOptions(req.query, this);
        if (isCrawler(req)) {
            urlOptions.content = &#x27;inline&#x27;;
        }
        urlOptions.userAgent = req.header(&#x27;user-agent&#x27;);

        // Note that the URL matching is done in the prepware middleware function
        this._loadURL(req.urlParsed, req.appjsParts, req.appjsMatch, this.renderer, urlOptions,
        function(err, result) {
            if (err) {
                dandy.logException(err);
                send(err, true);
            } else {
                send(result);
            }
        });

        function send(result, isError) {
            if (result.dependencies) {
                res.dependencies = _.pluck(result.dependencies, &#x27;path&#x27;);
            }

            var mimeType = result.mimeType || (result.path
                ? mime.lookup(result.path) || defaultMimeType
                : htmlMimeType);

            if (isTextMimeType(mimeType)) {
                mimeType += &#x27;; charset=UTF-8&#x27;
            }

            res.header(&#x27;Content-Type&#x27;, mimeType);

            if (!isError) {
                var latestTime = findLatestMtime(result.dependencies || []);
                if (latestTime) {
                    res.header(&#x27;ETag&#x27;, latestTime);
                }

                // if (result.permanent || isCDN(req)) {
                //     res.header(&#x27;Cache-Control&#x27;, &#x27;public, max-age=31536000&#x27;);
                // } else {
                    res.header(&#x27;Cache-Control&#x27;, &#x27;public, max-age=0&#x27;);
                // }
            }

            res.send(result.body, result.error || 200);
        }
    }

    if (this.cache) {
        this.cache.on(&#x27;unmonitor&#x27;, _.bind(function(URL) {
            this.invalidate(URL);
        }, this));
    }

    if (this.socket) {
        this._listenToSocket();
    }
    var cacheMiddleware = this.cache ? cacheware(this.cache) : noware;
    return [prepware(this), uaware(this), cacheMiddleware, _.bind(handler, this)];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.App.prototype.staticRoute" id="apidoc.element.app.js.App.prototype.staticRoute">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>staticRoute
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">staticRoute = function () {
    function handler(req, res, next) {
        var filePath;
        if (!req.appjsMatch) {
            filePath = &#x27;index.html&#x27;;
        } else {
            filePath = req.appjsParts.slice(1).join(&#x27;/&#x27;);
        }

        filePath = path.join(this.repoPath, filePath);
        fs.stat(filePath, abind(function(err, stat) {
            var dependencies = [{path: filePath, mtime: stat.mtime.getTime()}];
            fs.readFile(filePath, abind(function(err, source) {
                send.call(this, {path: filePath, body: source, error: err}, !!err);
            }, next, this));
        }, next, this));

        function send(result, isError) {
            var mimeType = result.mimeType || (result.path
                ? mime.lookup(result.path) || defaultMimeType
                : htmlMimeType);

            if (isTextMimeType(mimeType)) {
                mimeType += &#x27;; charset=UTF-8&#x27;
            }

            res.header(&#x27;Content-Type&#x27;, mimeType);

            if (!isError) {
                res.header(&#x27;ETag&#x27;, this.appVersion);

                // if (result.permanent || isCDN(req)) {
                //     res.header(&#x27;Cache-Control&#x27;, &#x27;public, max-age=31536000&#x27;);
                // } else {
                    res.header(&#x27;Cache-Control&#x27;, &#x27;public, max-age=0&#x27;);
                // }
            }

            res.send(result.body, result.error || 200);
        }
    }

    if (this.cache) {
        this.cache.on(&#x27;unmonitor&#x27;, _.bind(function(URL) {
            this.invalidate(URL);
        }, this));
    }

    var cacheMiddleware = this.cache ? cacheware(this.cache) : noware;
    return [prepware(this), cacheMiddleware, _.bind(handler, this)];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>




















</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.app.js.App.prototype._assignConfig" id="apidoc.module.app.js.App.prototype._assignConfig">module app.js.App.prototype._assignConfig</a></h1>


    <h2>
        <a href="#apidoc.element.app.js.App.prototype._assignConfig._assignConfig" id="apidoc.element.app.js.App.prototype._assignConfig._assignConfig">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_assignConfig
        <span class="apidocSignatureSpan">(conf)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_assignConfig = function (conf) {
    for (var name in defaults) {
        if (name == &#x22;configs&#x22;) {
            var branch = process.env.NODE_ENV == &#x22;production&#x22;
                         ? defaults.configs.production
                         : defaults.configs.development;
            for (var name in branch) {
                this[name] = name in conf ? conf[name] : branch[name];
            }
        } else {
            this[name] = name in conf ? conf[name] : defaults[name];
        }
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var reRootFiles = /(robots\.txt)|(favicon\.ico)|(apple-touch-icon(.*?)\.png)/;

// *************************************************************************************************

function App(conf) {
this.paths = process.env.NODE_PATH ? process.env.NODE_PATH.split(&#x27;;&#x27;) : [];

this.<span class="apidocCodeKeywordSpan">_assignConfig</span>(conf);

if (this.repo) {
    this.repo = this.repo.replace(/^~/, process.env.HOME);
}

this.base = addTrailingSlash(this.base);
this.baseLength = this.base.split(&#x22;/&#x22;).length-2;
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.app.js.App.prototype._cleanJSPath" id="apidoc.module.app.js.App.prototype._cleanJSPath">module app.js.App.prototype._cleanJSPath</a></h1>


    <h2>
        <a href="#apidoc.element.app.js.App.prototype._cleanJSPath._cleanJSPath" id="apidoc.element.app.js.App.prototype._cleanJSPath._cleanJSPath">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_cleanJSPath
        <span class="apidocSignatureSpan">(jsPath, renderer)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_cleanJSPath = function (jsPath, renderer) {
    return jsPath
        ? path.join(path.dirname(jsPath), path.basename(jsPath, &#x27;.js&#x27;))
        : this.client;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
            }, cb, this));
        }, cb, this));
    }
}, cb, this));
    },

    _loadJS: function(modulePath, renderer, options, cb) {
var scriptPath = this.<span class="apidocCodeKeywordSpan">_cleanJSPath</span>(modulePath, renderer);
var basePath = scriptPath == this.client ? null : this.client;

var searchPaths = [basePath];
if (this.paths.length) {
    searchPaths.push.apply(searchPaths, this.paths);
}
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.app.js.App.prototype._listenToSocket" id="apidoc.module.app.js.App.prototype._listenToSocket">module app.js.App.prototype._listenToSocket</a></h1>


    <h2>
        <a href="#apidoc.element.app.js.App.prototype._listenToSocket._listenToSocket" id="apidoc.element.app.js.App.prototype._listenToSocket._listenToSocket">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_listenToSocket
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_listenToSocket = function () {
    var u = url.parse(&#x27;ws://&#x27; + this.socket);
    var ws = require(&#x22;websocket-server&#x22;);
    this.socketServer = ws.createServer();
    this.socketServer.listen(u.port);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    if (this.cache) {
        this.cache.on(&#x27;unmonitor&#x27;, _.bind(function(URL) {
            this.invalidate(URL);
        }, this));
    }

    if (this.socket) {
        this.<span class="apidocCodeKeywordSpan">_listenToSocket</span>();
    }
    var cacheMiddleware = this.cache ? cacheware(this.cache) : noware;
    return [prepware(this), uaware(this), cacheMiddleware, _.bind(handler, this)];
},

staticRoute: function() {
    function handler(req, res, next) {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.app.js.App.prototype._loadAppcache" id="apidoc.module.app.js.App.prototype._loadAppcache">module app.js.App.prototype._loadAppcache</a></h1>


    <h2>
        <a href="#apidoc.element.app.js.App.prototype._loadAppcache._loadAppcache" id="apidoc.element.app.js.App.prototype._loadAppcache._loadAppcache">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadAppcache
        <span class="apidocSignatureSpan">(renderer, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_loadAppcache = function (renderer, options, cb) {
    renderer.renderAppcache(options,
        abind(function(err, result) {
            cb(0, {
                body: result.source,
                mimeType: &#x27;text/cache-manifest&#x27;,
                permanent: options.js == &#x22;inline&#x22; &#x26;&#x26; options.css == &#x22;inline&#x22;
            });
        }, cb)
    );
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        options.js = &#x27;source&#x27;;
        options.css = &#x27;included&#x27;;
    }
    this._loadJS(parts.slice(3).join(&#x27;/&#x27;), renderer, options, cb);
} else if (parts[2] == &#x27;css&#x27;) {
    this._loadCSS(renderer, options, cb);
} else if (parts[2] == &#x27;cache.manifest&#x27;) {
    this.<span class="apidocCodeKeywordSpan">_loadAppcache</span>(renderer, options, cb);
} else if (parts[2] == &#x27;has&#x27;) {
    this._loadHas(renderer, options, cb);
} else if (parts[2] == &#x27;polyfills&#x27;) {
    this._loadPolyfills(renderer, options, cb);
} else {
    cb(&#x22;Not found&#x22;);
}
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.app.js.App.prototype._loadAppjs" id="apidoc.module.app.js.App.prototype._loadAppjs">module app.js.App.prototype._loadAppjs</a></h1>


    <h2>
        <a href="#apidoc.element.app.js.App.prototype._loadAppjs._loadAppjs" id="apidoc.element.app.js.App.prototype._loadAppjs._loadAppjs">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadAppjs
        <span class="apidocSignatureSpan">(renderer, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_loadAppjs = function (renderer, options, cb) {
    var scriptName;
    if (options.loader == &#x22;static&#x22; || options.js == &#x22;worker&#x22;) {
        scriptName = &#x22;appjs-static.js&#x22;;
    } else if (options.loader == &#x22;dynamic&#x22;) {
        scriptName = &#x22;appjs-dynamic.js&#x22;;
    } else if (options.loader == &#x22;standalone&#x22;) {
        scriptName = &#x22;appjs-standalone.js&#x22;;
    }
    if (scriptName) {
        var appjsPath = path.resolve(__dirname, &#x27;..&#x27;, &#x27;client&#x27;, scriptName);
        renderer.renderScriptRaw(appjsPath, &#x27;&#x27;, options,
            abind(function(err, result) {
                cb(0, {path: appjsPath, body: result.source, dependencies: result.dependencies});
            }, cb)
        );
    } else {
        cb(new Error(&#x22;Loader unspecified&#x22;));
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        this.renderer.renderResources(options, cb);
    }, cb, this));
},

_loadURL: function(urlParsed, parts, m, renderer, options, cb) {
    if (m) {
        if (parts.length == 2) {
            this.<span class="apidocCodeKeywordSpan">_loadAppjs</span>(renderer, options, cb);
        } else {
            if (parts[2] == &#x27;static&#x27;) {
                this._loadStatic(parts.slice(3).join(&#x27;/&#x27;), renderer, options, cb);
            } else if (parts[2] == &#x27;js&#x27;) {
                var userAgent = m[2] ? unescape(m[2].substr(1)) : &#x27;&#x27;;
                if (userAgent) {
                    options.userAgent = userAgent;
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.app.js.App.prototype._loadCSS" id="apidoc.module.app.js.App.prototype._loadCSS">module app.js.App.prototype._loadCSS</a></h1>


    <h2>
        <a href="#apidoc.element.app.js.App.prototype._loadCSS._loadCSS" id="apidoc.element.app.js.App.prototype._loadCSS._loadCSS">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadCSS
        <span class="apidocSignatureSpan">(renderer, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_loadCSS = function (renderer, options, cb) {
    renderer.renderStylesheet(options,
        abind(function(err, result) {
            cb(0, {path: result.path, body: result.source, dependencies: result.dependencies,
                   permanent: true});
        }, cb)
    );
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

    if (parts.length &#x3e; 3) {
        options.js = &#x27;source&#x27;;
        options.css = &#x27;included&#x27;;
    }
    this._loadJS(parts.slice(3).join(&#x27;/&#x27;), renderer, options, cb);
} else if (parts[2] == &#x27;css&#x27;) {
    this.<span class="apidocCodeKeywordSpan">_loadCSS</span>(renderer, options, cb);
} else if (parts[2] == &#x27;cache.manifest&#x27;) {
    this._loadAppcache(renderer, options, cb);
} else if (parts[2] == &#x27;has&#x27;) {
    this._loadHas(renderer, options, cb);
} else if (parts[2] == &#x27;polyfills&#x27;) {
    this._loadPolyfills(renderer, options, cb);
} else {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.app.js.App.prototype._loadHas" id="apidoc.module.app.js.App.prototype._loadHas">module app.js.App.prototype._loadHas</a></h1>


    <h2>
        <a href="#apidoc.element.app.js.App.prototype._loadHas._loadHas" id="apidoc.element.app.js.App.prototype._loadHas._loadHas">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadHas
        <span class="apidocSignatureSpan">(renderer, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_loadHas = function (renderer, options, cb) {
    renderer.renderHas(options, abind(function(err, result) {
        cb(0, {path: result.path, body: result.source, dependencies: result.dependencies});
    }, cb));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
            }
            this._loadJS(parts.slice(3).join(&#x27;/&#x27;), renderer, options, cb);
        } else if (parts[2] == &#x27;css&#x27;) {
            this._loadCSS(renderer, options, cb);
        } else if (parts[2] == &#x27;cache.manifest&#x27;) {
            this._loadAppcache(renderer, options, cb);
        } else if (parts[2] == &#x27;has&#x27;) {
            this.<span class="apidocCodeKeywordSpan">_loadHas</span>(renderer, options, cb);
        } else if (parts[2] == &#x27;polyfills&#x27;) {
            this._loadPolyfills(renderer, options, cb);
        } else {
            cb(&#x22;Not found&#x22;);
        }
    }
} else if (reRootFiles.exec(parts[1])) {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.app.js.App.prototype._loadJS" id="apidoc.module.app.js.App.prototype._loadJS">module app.js.App.prototype._loadJS</a></h1>


    <h2>
        <a href="#apidoc.element.app.js.App.prototype._loadJS._loadJS" id="apidoc.element.app.js.App.prototype._loadJS._loadJS">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadJS
        <span class="apidocSignatureSpan">(modulePath, renderer, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_loadJS = function (modulePath, renderer, options, cb) {
    var scriptPath = this._cleanJSPath(modulePath, renderer);
    var basePath = scriptPath == this.client ? null : this.client;

    var searchPaths = [basePath];
    if (this.paths.length) {
        searchPaths.push.apply(searchPaths, this.paths);
    }

    pkg.searchScript(scriptPath, searchPaths, abind(function(err, findings) {
        if (findings) {
            renderer.renderScript(findings.path, findings.name, options, true,
                abind(function(err, result) {
                    cb(0, {path: findings.path, name: findings.name, body: result.source,
                           dependencies: result.dependencies, permanent: true});
                }, cb)
            );
        }
    }, cb, this));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        options.userAgent = userAgent;
    }

    if (parts.length &#x3e; 3) {
        options.js = &#x27;source&#x27;;
        options.css = &#x27;included&#x27;;
    }
    this.<span class="apidocCodeKeywordSpan">_loadJS</span>(parts.slice(3).join(&#x27;/&#x27;), renderer, options, cb);
} else if (parts[2] == &#x27;css&#x27;) {
    this._loadCSS(renderer, options, cb);
} else if (parts[2] == &#x27;cache.manifest&#x27;) {
    this._loadAppcache(renderer, options, cb);
} else if (parts[2] == &#x27;has&#x27;) {
    this._loadHas(renderer, options, cb);
} else if (parts[2] == &#x27;polyfills&#x27;) {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.app.js.App.prototype._loadPage" id="apidoc.module.app.js.App.prototype._loadPage">module app.js.App.prototype._loadPage</a></h1>


    <h2>
        <a href="#apidoc.element.app.js.App.prototype._loadPage._loadPage" id="apidoc.element.app.js.App.prototype._loadPage._loadPage">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadPage
        <span class="apidocSignatureSpan">(URL, renderer, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_loadPage = function (URL, renderer, options, cb) {
    renderer.renderPage(URL, options, abind(function(err, result) {
        cb(0, {
            body: result.source,
            permanent: options.js == &#x22;inline&#x22; &#x26;&#x26; options.css == &#x22;inline&#x22;,
            dependencies: result.dependencies,
        });
    }, cb));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                cb(&#x22;Not found&#x22;);
            }
        }
    } else if (reRootFiles.exec(parts[1])) {
        var newURL = this.staticPath + &#x27;/&#x27; + this.packageName + &#x27;/&#x27; + parts[1];
        this.loadURL(newURL, renderer, options, cb);
    } else {
        this.<span class="apidocCodeKeywordSpan">_loadPage</span>(urlParsed, renderer, options, cb);
    }
},

getContentScript: function(renderer, cb) {
    if (!this.contentScript) {
        this.loadURL(this.jsPath, renderer, {loader: &#x27;static&#x27;, js: &#x27;inline&#x27;, beautify: true},
        abind(function(err, js) {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.app.js.App.prototype._loadPolyfills" id="apidoc.module.app.js.App.prototype._loadPolyfills">module app.js.App.prototype._loadPolyfills</a></h1>


    <h2>
        <a href="#apidoc.element.app.js.App.prototype._loadPolyfills._loadPolyfills" id="apidoc.element.app.js.App.prototype._loadPolyfills._loadPolyfills">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadPolyfills
        <span class="apidocSignatureSpan">(renderer, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_loadPolyfills = function (renderer, options, cb) {
    renderer.renderPolyfills(options, abind(function(err, result) {
        cb(0, {path: result.path, body: result.source, dependencies: result.dependencies});
    }, cb));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        } else if (parts[2] == &#x27;css&#x27;) {
            this._loadCSS(renderer, options, cb);
        } else if (parts[2] == &#x27;cache.manifest&#x27;) {
            this._loadAppcache(renderer, options, cb);
        } else if (parts[2] == &#x27;has&#x27;) {
            this._loadHas(renderer, options, cb);
        } else if (parts[2] == &#x27;polyfills&#x27;) {
            this.<span class="apidocCodeKeywordSpan">_loadPolyfills</span>(renderer, options, cb);
        } else {
            cb(&#x22;Not found&#x22;);
        }
    }
} else if (reRootFiles.exec(parts[1])) {
    var newURL = this.staticPath + &#x27;/&#x27; + this.packageName + &#x27;/&#x27; + parts[1];
    this.loadURL(newURL, renderer, options, cb);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.app.js.App.prototype._loadStatic" id="apidoc.module.app.js.App.prototype._loadStatic">module app.js.App.prototype._loadStatic</a></h1>


    <h2>
        <a href="#apidoc.element.app.js.App.prototype._loadStatic._loadStatic" id="apidoc.element.app.js.App.prototype._loadStatic._loadStatic">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadStatic
        <span class="apidocSignatureSpan">(staticPath, renderer, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_loadStatic = function (staticPath, renderer, options, cb) {
    pkg.searchStatic(staticPath, this.paths, abind(function(err, filePath) {
        if (filePath) {
            fs.stat(filePath, abind(function(err, stat) {
                var dependencies = [{path: filePath, mtime: stat.mtime.getTime()}];
                fs.readFile(filePath, abind(function(err, source) {
                    if (mime.lookup(filePath) == &#x27;text/css&#x27;) {
                        renderer.compressCSS(source+&#x27;&#x27;, staticPath, options,
                        function(err, source) {
                            cb(0, {path: filePath, body: source, dependencies: dependencies});
                        });
                    } else {
                        cb(0, {path: filePath, body: source, raw: true,
                               dependencies: dependencies});
                    }
                }, cb, this));
            }, cb, this));
        }
    }, cb, this));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

    _loadURL: function(urlParsed, parts, m, renderer, options, cb) {
        if (m) {
            if (parts.length == 2) {
                this._loadAppjs(renderer, options, cb);
            } else {
                if (parts[2] == &#x27;static&#x27;) {
this.<span class="apidocCodeKeywordSpan">_loadStatic</span>(parts.slice(3).join(&#x27;/&#x27;), renderer, options, cb);
                } else if (parts[2] == &#x27;js&#x27;) {
var userAgent = m[2] ? unescape(m[2].substr(1)) : &#x27;&#x27;;
if (userAgent) {
    options.userAgent = userAgent;
}

if (parts.length &#x3e; 3) {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.app.js.App.prototype._loadURL" id="apidoc.module.app.js.App.prototype._loadURL">module app.js.App.prototype._loadURL</a></h1>


    <h2>
        <a href="#apidoc.element.app.js.App.prototype._loadURL._loadURL" id="apidoc.element.app.js.App.prototype._loadURL._loadURL">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_loadURL
        <span class="apidocSignatureSpan">(urlParsed, parts, m, renderer, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_loadURL = function (urlParsed, parts, m, renderer, options, cb) {
    if (m) {
        if (parts.length == 2) {
            this._loadAppjs(renderer, options, cb);
        } else {
            if (parts[2] == &#x27;static&#x27;) {
                this._loadStatic(parts.slice(3).join(&#x27;/&#x27;), renderer, options, cb);
            } else if (parts[2] == &#x27;js&#x27;) {
                var userAgent = m[2] ? unescape(m[2].substr(1)) : &#x27;&#x27;;
                if (userAgent) {
                    options.userAgent = userAgent;
                }

                if (parts.length &#x3e; 3) {
                    options.js = &#x27;source&#x27;;
                    options.css = &#x27;included&#x27;;
                }
                this._loadJS(parts.slice(3).join(&#x27;/&#x27;), renderer, options, cb);
            } else if (parts[2] == &#x27;css&#x27;) {
                this._loadCSS(renderer, options, cb);
            } else if (parts[2] == &#x27;cache.manifest&#x27;) {
                this._loadAppcache(renderer, options, cb);
            } else if (parts[2] == &#x27;has&#x27;) {
                this._loadHas(renderer, options, cb);
            } else if (parts[2] == &#x27;polyfills&#x27;) {
                this._loadPolyfills(renderer, options, cb);
            } else {
                cb(&#x22;Not found&#x22;);
            }
        }
    } else if (reRootFiles.exec(parts[1])) {
        var newURL = this.staticPath + &#x27;/&#x27; + this.packageName + &#x27;/&#x27; + parts[1];
        this.loadURL(newURL, renderer, options, cb);
    } else {
        this._loadPage(urlParsed, renderer, options, cb);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var urlOptions = readOptions(req.query, this);
if (isCrawler(req)) {
    urlOptions.content = &#x27;inline&#x27;;
}
urlOptions.userAgent = req.header(&#x27;user-agent&#x27;);

// Note that the URL matching is done in the prepware middleware function
this.<span class="apidocCodeKeywordSpan">_loadURL</span>(req.urlParsed, req.appjsParts, req.appjsMatch, this.renderer, urlOptions
,
function(err, result) {
    if (err) {
        dandy.logException(err);
        send(err, true);
    } else {
        send(result);
    }
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.app.js.App.prototype._prepare" id="apidoc.module.app.js.App.prototype._prepare">module app.js.App.prototype._prepare</a></h1>


    <h2>
        <a href="#apidoc.element.app.js.App.prototype._prepare._prepare" id="apidoc.element.app.js.App.prototype._prepare._prepare">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>_prepare
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_prepare = function (cb) {
    if (!this.dependencies) {
        var searchPaths = this.paths;
        pkg.traceScript(this.client, this.paths, false, abind(function(err, deps) {
            this.dependencies = deps;

            async.parallel([
                ibind(function(next) {
                    hascan.getFeatureDB(_.keys(deps.has), abind(function(err, featureDB) {
                        this.featureDB = featureDB;
                        next(0);
                    }, next, this));
                }, cb, this),

                ibind(function(next) {
                    if (!this.packageName) {
                        pkg.searchScript(this.client, searchPaths, abind(function(err, findings) {
                            pkg.findPackageInfo(findings.path, abind(function(err, result) {
                                this.packageName = result.info.name;
                                next(0);
                            }, cb, this));
                        }, cb, this));
                    } else {
                        next(0);
                    }
                }, cb, this),

                ibind(function(next) {
                    if (!this.polyfills) {
                        var polyfillsDirPath = path.join(__dirname, &#x27;..&#x27;, &#x27;client&#x27;, &#x27;polyfills&#x27;);
                        this.polyfills = {};
                        fs.readdir(polyfillsDirPath, abind(function(err, names) {
                            if (!err) {
                                _.each(names, ibind(function(name) {
                                    var feature = path.basename(name, &#x27;.js&#x27;);
                                    this.polyfills[feature] = true;
                                }, cb, this));
                            }
                            next(0, deps);
                        }, cb, this));
                    } else {
                        next(0);
                    }
                }, cb, this),
            ], abind(function(err, results) {
                cb(0, deps);
            }, cb, this));
        }, cb, this));
    } else {
        cb(0, this.dependencies);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
loadURL: function(URL, renderer, options, cb) {
    var req = parseAppjsURL(this, URL, {});
    return this._loadURL(req.urlParsed, req.appjsParts, req.appjsMatch, renderer, options, cb)
},

loadResources: function(req, cb) {
    var options = readOptions(req, this);
    this.<span class="apidocCodeKeywordSpan">_prepare</span>(abind(function(err) {
        this.renderer.renderResources(options, cb);
    }, cb, this));
},

_loadURL: function(urlParsed, parts, m, renderer, options, cb) {
    if (m) {
        if (parts.length == 2) {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.app.js.App.prototype.getContentScript" id="apidoc.module.app.js.App.prototype.getContentScript">module app.js.App.prototype.getContentScript</a></h1>


    <h2>
        <a href="#apidoc.element.app.js.App.prototype.getContentScript.getContentScript" id="apidoc.element.app.js.App.prototype.getContentScript.getContentScript">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>getContentScript
        <span class="apidocSignatureSpan">(renderer, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getContentScript = function (renderer, cb) {
    if (!this.contentScript) {
        this.loadURL(this.jsPath, renderer, {loader: &#x27;static&#x27;, js: &#x27;inline&#x27;, beautify: true},
        abind(function(err, js) {
            this.contentScript = vm.createScript(js.body, &#x27;document.js&#x27;);
            cb(0, this.contentScript);
        }, cb, this));
    } else {
        cb(0, this.contentScript);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

        ].join(&#x27;\n&#x27;)
    });
},

renderContent: function(URL, html, options, cb) {
    if (options.content == &#x22;inline&#x22;) {
        this.app.<span class="apidocCodeKeywordSpan">getContentScript</span>(this, abind(function(err, script) {
            this._runInSandbox(script, URL, html, cb);
        }, cb, this));
    } else {
        cb(0, html);
    }
},
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.app.js.App.prototype.invalidate" id="apidoc.module.app.js.App.prototype.invalidate">module app.js.App.prototype.invalidate</a></h1>


    <h2>
        <a href="#apidoc.element.app.js.App.prototype.invalidate.invalidate" id="apidoc.element.app.js.App.prototype.invalidate.invalidate">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>invalidate
        <span class="apidocSignatureSpan">(dependentURL)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">invalidate = function (dependentURL) {
    delete this.contentScript;
    delete this.featureDB;
    delete this.dependencies;

    if (this.socketServer) {
        this.socketServer.broadcast(JSON.stringify({
            name: &#x27;invalidate&#x27;,
            URL: this.normalizeURL(dependentURL.url)
        }));
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

        res.send(result.body, result.error || 200);
    }
}

if (this.cache) {
    this.cache.on(&#x27;unmonitor&#x27;, _.bind(function(URL) {
        this.<span class="apidocCodeKeywordSpan">invalidate</span>(URL);
    }, this));
}

if (this.socket) {
    this._listenToSocket();
}
var cacheMiddleware = this.cache ? cacheware(this.cache) : noware;
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.app.js.App.prototype.loadResources" id="apidoc.module.app.js.App.prototype.loadResources">module app.js.App.prototype.loadResources</a></h1>


    <h2>
        <a href="#apidoc.element.app.js.App.prototype.loadResources.loadResources" id="apidoc.element.app.js.App.prototype.loadResources.loadResources">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>loadResources
        <span class="apidocSignatureSpan">(req, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">loadResources = function (req, cb) {
    var options = readOptions(req, this);
    this._prepare(abind(function(err) {
        this.renderer.renderResources(options, cb);
    }, cb, this));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.app.js.App.prototype.loadURL" id="apidoc.module.app.js.App.prototype.loadURL">module app.js.App.prototype.loadURL</a></h1>


    <h2>
        <a href="#apidoc.element.app.js.App.prototype.loadURL.loadURL" id="apidoc.element.app.js.App.prototype.loadURL.loadURL">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>loadURL
        <span class="apidocSignatureSpan">(URL, renderer, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">loadURL = function (URL, renderer, options, cb) {
    var req = parseAppjsURL(this, URL, {});
    return this._loadURL(req.urlParsed, req.appjsParts, req.appjsMatch, renderer, options, cb)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                this._loadPolyfills(renderer, options, cb);
            } else {
                cb(&#x22;Not found&#x22;);
            }
        }
    } else if (reRootFiles.exec(parts[1])) {
        var newURL = this.staticPath + &#x27;/&#x27; + this.packageName + &#x27;/&#x27; + parts[1];
        this.<span class="apidocCodeKeywordSpan">loadURL</span>(newURL, renderer, options, cb);
    } else {
        this._loadPage(urlParsed, renderer, options, cb);
    }
},

getContentScript: function(renderer, cb) {
    if (!this.contentScript) {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.app.js.App.prototype.normalizeURL" id="apidoc.module.app.js.App.prototype.normalizeURL">module app.js.App.prototype.normalizeURL</a></h1>


    <h2>
        <a href="#apidoc.element.app.js.App.prototype.normalizeURL.normalizeURL" id="apidoc.element.app.js.App.prototype.normalizeURL.normalizeURL">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>normalizeURL
        <span class="apidocSignatureSpan">(URL, category, timestamp)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">normalizeURL = function (URL, category, timestamp) {
    return this.renderer.renderURL(URL, category, true, timestamp);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    delete this.contentScript;
    delete this.featureDB;
    delete this.dependencies;

    if (this.socketServer) {
        this.socketServer.broadcast(JSON.stringify({
            name: &#x27;invalidate&#x27;,
            URL: this.<span class="apidocCodeKeywordSpan">normalizeURL</span>(dependentURL.url)
        }));
    }
},

reloadPage: function() {
    if (this.socketServer) {
        this.socketServer.broadcast(JSON.stringify({
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.app.js.App.prototype.reloadPage" id="apidoc.module.app.js.App.prototype.reloadPage">module app.js.App.prototype.reloadPage</a></h1>


    <h2>
        <a href="#apidoc.element.app.js.App.prototype.reloadPage.reloadPage" id="apidoc.element.app.js.App.prototype.reloadPage.reloadPage">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>reloadPage
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">reloadPage = function () {
    if (this.socketServer) {
        this.socketServer.broadcast(JSON.stringify({
            name: &#x27;reload&#x27;
        }));
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.app.js.App.prototype.route" id="apidoc.module.app.js.App.prototype.route">module app.js.App.prototype.route</a></h1>


    <h2>
        <a href="#apidoc.element.app.js.App.prototype.route.route" id="apidoc.element.app.js.App.prototype.route.route">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>route
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">route = function () {
    function handler(req, res, next) {
        var urlOptions = readOptions(req.query, this);
        if (isCrawler(req)) {
            urlOptions.content = &#x27;inline&#x27;;
        }
        urlOptions.userAgent = req.header(&#x27;user-agent&#x27;);

        // Note that the URL matching is done in the prepware middleware function
        this._loadURL(req.urlParsed, req.appjsParts, req.appjsMatch, this.renderer, urlOptions,
        function(err, result) {
            if (err) {
                dandy.logException(err);
                send(err, true);
            } else {
                send(result);
            }
        });

        function send(result, isError) {
            if (result.dependencies) {
                res.dependencies = _.pluck(result.dependencies, &#x27;path&#x27;);
            }

            var mimeType = result.mimeType || (result.path
                ? mime.lookup(result.path) || defaultMimeType
                : htmlMimeType);

            if (isTextMimeType(mimeType)) {
                mimeType += &#x27;; charset=UTF-8&#x27;
            }

            res.header(&#x27;Content-Type&#x27;, mimeType);

            if (!isError) {
                var latestTime = findLatestMtime(result.dependencies || []);
                if (latestTime) {
                    res.header(&#x27;ETag&#x27;, latestTime);
                }

                // if (result.permanent || isCDN(req)) {
                //     res.header(&#x27;Cache-Control&#x27;, &#x27;public, max-age=31536000&#x27;);
                // } else {
                    res.header(&#x27;Cache-Control&#x27;, &#x27;public, max-age=0&#x27;);
                // }
            }

            res.send(result.body, result.error || 200);
        }
    }

    if (this.cache) {
        this.cache.on(&#x27;unmonitor&#x27;, _.bind(function(URL) {
            this.invalidate(URL);
        }, this));
    }

    if (this.socket) {
        this._listenToSocket();
    }
    var cacheMiddleware = this.cache ? cacheware(this.cache) : noware;
    return [prepware(this), uaware(this), cacheMiddleware, _.bind(handler, this)];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.app.js.App.prototype.staticRoute" id="apidoc.module.app.js.App.prototype.staticRoute">module app.js.App.prototype.staticRoute</a></h1>


    <h2>
        <a href="#apidoc.element.app.js.App.prototype.staticRoute.staticRoute" id="apidoc.element.app.js.App.prototype.staticRoute.staticRoute">
        function <span class="apidocSignatureSpan">app.js.App.prototype.</span>staticRoute
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">staticRoute = function () {
    function handler(req, res, next) {
        var filePath;
        if (!req.appjsMatch) {
            filePath = &#x27;index.html&#x27;;
        } else {
            filePath = req.appjsParts.slice(1).join(&#x27;/&#x27;);
        }

        filePath = path.join(this.repoPath, filePath);
        fs.stat(filePath, abind(function(err, stat) {
            var dependencies = [{path: filePath, mtime: stat.mtime.getTime()}];
            fs.readFile(filePath, abind(function(err, source) {
                send.call(this, {path: filePath, body: source, error: err}, !!err);
            }, next, this));
        }, next, this));

        function send(result, isError) {
            var mimeType = result.mimeType || (result.path
                ? mime.lookup(result.path) || defaultMimeType
                : htmlMimeType);

            if (isTextMimeType(mimeType)) {
                mimeType += &#x27;; charset=UTF-8&#x27;
            }

            res.header(&#x27;Content-Type&#x27;, mimeType);

            if (!isError) {
                res.header(&#x27;ETag&#x27;, this.appVersion);

                // if (result.permanent || isCDN(req)) {
                //     res.header(&#x27;Cache-Control&#x27;, &#x27;public, max-age=31536000&#x27;);
                // } else {
                    res.header(&#x27;Cache-Control&#x27;, &#x27;public, max-age=0&#x27;);
                // }
            }

            res.send(result.body, result.error || 200);
        }
    }

    if (this.cache) {
        this.cache.on(&#x27;unmonitor&#x27;, _.bind(function(URL) {
            this.invalidate(URL);
        }, this));
    }

    var cacheMiddleware = this.cache ? cacheware(this.cache) : noware;
    return [prepware(this), cacheMiddleware, _.bind(handler, this)];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.app.js.Renderer" id="apidoc.module.app.js.Renderer">module app.js.Renderer</a></h1>


    <h2>
        <a href="#apidoc.element.app.js.Renderer.Renderer" id="apidoc.element.app.js.Renderer.Renderer">
        function <span class="apidocSignatureSpan">app.js.</span>Renderer
        <span class="apidocSignatureSpan">(app, api, apiCache, baseURLPath)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Renderer = function (app, api, apiCache, baseURLPath) {
    this.app = app;
    this.api = api;
    this.apiCache = apiCache;
    this.baseURLPath = addTrailingSlash(baseURLPath);
    this.builtinScripts = [app.resourceBase];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.app.js.pkg" id="apidoc.module.app.js.pkg">module app.js.pkg</a></h1>


    <h2>
        <a href="#apidoc.element.app.js.pkg.findPackageInfo" id="apidoc.element.app.js.pkg.findPackageInfo">
        function <span class="apidocSignatureSpan">app.js.pkg.</span>findPackageInfo
        <span class="apidocSignatureSpan">(scriptPath, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">findPackageInfo = function (scriptPath, cb) {
    if (scriptPath in packageCache) {
        return cb(0, packageCache[scriptPath]);
    }
    exports.findPackagePath(scriptPath, abind(function(err, packagePath) {
        fs.readFile(packagePath, abind(function(err, packageJSON) {
            var packageInfo = JSON.parse(packageJSON);
            var payload = {path: packagePath, info: packageInfo};
            packageCache[scriptPath] = payload;
            cb(0, payload);
        }, cb));
    }, cb));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        next(0);
    }, next, this));
}, cb, this),

ibind(function(next) {
    if (!this.packageName) {
        pkg.searchScript(this.client, searchPaths, abind(function(err, findings) {
            pkg.<span class="apidocCodeKeywordSpan">findPackageInfo</span>(findings.path, abind(function(err, result) {
                this.packageName = result.info.name;
                next(0);
            }, cb, this));
        }, cb, this));
    } else {
        next(0);
    }
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.pkg.findPackagePath" id="apidoc.element.app.js.pkg.findPackagePath">
        function <span class="apidocSignatureSpan">app.js.pkg.</span>findPackagePath
        <span class="apidocSignatureSpan">(scriptPath, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">findPackagePath = function (scriptPath, cb) {
    var dirName = path.dirname(scriptPath);
    checkForPackage(dirName);

    function checkForPackage(dirName) {
        if (!dirName) { cb(&#x22;Not found&#x22;); return; }

        var packagePath = path.join(dirName, &#x22;package.json&#x22;);
        fs.stat(packagePath, function(err, stat) {
            if (err || !stat.isFile()) {
                // Keep searching upwards until we find directory containing package.json
                var nextPath = path.dirname(dirName);
                if (nextPath != dirName) {
                    checkForPackage(nextPath);
                } else {
                    cb(&#x22;Not found&#x22;);
                }
            } else {
                cb(0, packagePath);
            }
        });
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}, cb, this));
}

exports.findPackageInfo = function(scriptPath, cb) {
if (scriptPath in packageCache) {
    return cb(0, packageCache[scriptPath]);
}
exports.<span class="apidocCodeKeywordSpan">findPackagePath</span>(scriptPath, abind(function(err, packagePath) {
    fs.readFile(packagePath, abind(function(err, packageJSON) {
        var packageInfo = JSON.parse(packageJSON);
        var payload = {path: packagePath, info: packageInfo};
        packageCache[scriptPath] = payload;
        cb(0, payload);
    }, cb));
}, cb));
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.pkg.findPackageStaticPath" id="apidoc.element.app.js.pkg.findPackageStaticPath">
        function <span class="apidocSignatureSpan">app.js.pkg.</span>findPackageStaticPath
        <span class="apidocSignatureSpan">(scriptPath, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">findPackageStaticPath = function (scriptPath, cb) {
    exports.findPackageInfo(scriptPath, abind(function(err, result) {
        var staticPath = readStaticPath(result);
        if (staticPath) {
            cb(0, staticPath);
        } else {
            cb(&#x22;No static path for &#x22; + scriptPath);
        }
    }, cb, this));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    findBasePath(abind(function(err, basePath) {
try {
    var parts = modulePath.split(&#x27;/&#x27;);
    if (!parts.length) {
        cb(0, &#x27;&#x27;);
    }

    exports.<span class="apidocCodeKeywordSpan">findPackageStaticPath</span>(basePath, abind(function(err, staticPath) {
        var filePath = path.join(staticPath, parts.slice(1).join(&#x27;/&#x27;));
        cb(0, filePath);
    }, cb, this));
} catch (exc) {
    console.error(exc.stack)
    cb(exc);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.pkg.normalizeName" id="apidoc.element.app.js.pkg.normalizeName">
        function <span class="apidocSignatureSpan">app.js.pkg.</span>normalizeName
        <span class="apidocSignatureSpan">(name, baseName, isURL)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">normalizeName = function (name, baseName, isURL) {
    if (isURL) {
        if (!baseName || (name &#x26;&#x26; name[0] == &#x27;/&#x27;)) {
            return name;
        } else {
            return path.join(baseName, name);
        }
    } else {
        if (baseName &#x26;&#x26; name &#x26;&#x26; name[0] == &#x27;.&#x27;) {
            // Relative paths inside of root modules are contained within the module, not its parent
            if (baseName.indexOf(&#x27;/&#x27;) == -1) {
                baseName += &#x27;/&#x27;;
            }
            return path.normalize(path.join(baseName, name));
        } else {
            return name;
        }
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
++depth;

exports.searchScript(modulePath, basePath, tbind(function(err, findings) {
    fs.stat(findings.path, tbind(function(err, stat) {
        fs.readFile(findings.path, tbind(function(err, source) {
            var m;
            while (m = reStyle.exec(source)) {
                var stylesheetPath = exports.<span class="apidocCodeKeywordSpan">normalizeName</span>(m[1], findings.name);
                traceStylesheet.apply(this, [stylesheetPath, m[0]]);
            }

            complete();
        }, this));
    }, this));
}, this));
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.pkg.searchScript" id="apidoc.element.app.js.pkg.searchScript">
        function <span class="apidocSignatureSpan">app.js.pkg.</span>searchScript
        <span class="apidocSignatureSpan">(modulePath, searchPaths, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">searchScript = function (modulePath, searchPaths, cb) {
    if (typeof(searchPaths) == &#x27;function&#x27;) { cb = searchPaths; searchPaths = null; }

    if (!(searchPaths instanceof Array)) {
        searchPaths = [searchPaths];
    } else {
        searchPaths = searchPaths.slice();
        searchPaths.push(null);
    }

    if (process.env.NODE_PATH) {
        searchPaths.push.apply(searchPaths, process.env.NODE_PATH.split(&#x27;;&#x27;));
    }

    if (modulePath[0] == &#x27;/&#x27;) {
        complete(modulePath);
    } else {
        searchBasePath(searchPaths.shift());
    }

    function searchBasePath(basePath) {
        var baseScriptPath;
        if (basePath) {
            try {
                baseScriptPath = path.dirname(require.resolve(basePath));
            } catch (exc) {
                baseScriptPath = basePath;
            }
        }
        if (baseScriptPath) {
            var absolutePath = path.resolve(baseScriptPath, modulePath);
            try {
                var scriptPath = require.resolve(absolutePath);
                return complete(scriptPath);
            } catch (exc) {

            }
        }

        if (baseScriptPath) {
            var baseDir = baseScriptPath;
            findInNodeModules(baseDir);
        } else {
            complete(modulePath);
        }
    }

<span class="apidocCodeCommentSpan">    /**
     * require.resolve unfortunately can&#x27;t be given a relative base path, so we have
     * to simulate its behavior ourself.  This here does the node_modules search.
     */
</span>    function findInNodeModules(containerPath) {
        fs.stat(containerPath, abind(function(err, stat) {
            if (stat.isDirectory()) {
                var foundPath = path.resolve(containerPath, &#x27;node_modules&#x27;, modulePath);
                try {
                    foundPath = require.resolve(foundPath);
                    complete(foundPath);
                } catch (exc) {
                    if (containerPath != &#x27;/&#x27;) {
                        findInNodeModules(path.dirname(containerPath));
                    } else {
                        tryNext();
                    }
                }
            } else {
                tryNext();
            }
        }, fail, this));
    }

    function complete(foundPath) {
        try {
            var scriptPath = require.resolve(foundPath);
            exports.shortenModulePath(scriptPath, abind(function(err, shortModulePath) {
                cb(0, {path: scriptPath, name: shortModulePath});
            }, fail, this));
        } catch (exc) {
            fail();
        }
    }

    function tryNext() {
        if (!searchPaths.length) {
            fail();
        } else {
            var nextPath = searchPaths.shift();
            searchBasePath(nextPath);
        }
    }

    function fail() {
        cb(new Error(&#x22;Module &#x27;&#x22; + modulePath + &#x22;&#x27; not found.&#x22;));
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var basePath = scriptPath == this.client ? null : this.client;

var searchPaths = [basePath];
if (this.paths.length) {
    searchPaths.push.apply(searchPaths, this.paths);
}

pkg.<span class="apidocCodeKeywordSpan">searchScript</span>(scriptPath, searchPaths, abind(function(err, findings) {
    if (findings) {
        renderer.renderScript(findings.path, findings.name, options, true,
            abind(function(err, result) {
                cb(0, {path: findings.path, name: findings.name, body: result.source,
                       dependencies: result.dependencies, permanent: true});
            }, cb)
        );
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.pkg.searchStatic" id="apidoc.element.app.js.pkg.searchStatic">
        function <span class="apidocSignatureSpan">app.js.pkg.</span>searchStatic
        <span class="apidocSignatureSpan">(modulePath, searchPaths, isURL, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">searchStatic = function (modulePath, searchPaths, isURL, cb) {
    if (typeof(isURL) == &#x27;function&#x27;) { cb = isURL; isURL = false; }
    if (typeof(searchPaths) == &#x27;function&#x27;) { cb = searchPaths; searchPaths = null; }

    modulePath = securePath(modulePath);
    if (!modulePath) { cb(&#x22;Illegal path&#x22;); return; }

    findBasePath(abind(function(err, basePath) {
        try {
            var parts = modulePath.split(&#x27;/&#x27;);
            if (!parts.length) {
                cb(0, &#x27;&#x27;);
            }

            exports.findPackageStaticPath(basePath, abind(function(err, staticPath) {
                var filePath = path.join(staticPath, parts.slice(1).join(&#x27;/&#x27;));
                cb(0, filePath);
            }, cb, this));
        } catch (exc) {
            console.error(exc.stack)
            cb(exc);
        }
    }, cb, this));

    function findBasePath(cb) {
        if (modulePath[0] == &#x27;.&#x27;) {
            cb(0, searchPaths[0]);
        } else {
            var baseModule = modulePath.split(&#x27;/&#x27;)[0];
            exports.searchScript(baseModule, searchPaths, abind(function(err, findings) {
                if (isURL) {
                    cb(0, findings.path);
                } else {
                    cb(0, findings.path);
                }
            }, cb, this));
        }
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
            permanent: options.js == &#x22;inline&#x22; &#x26;&#x26; options.css == &#x22;inline&#x22;,
            dependencies: result.dependencies,
        });
    }, cb));
},

_loadStatic: function(staticPath, renderer, options, cb) {
    pkg.<span class="apidocCodeKeywordSpan">searchStatic</span>(staticPath, this.paths, abind(function(err, filePath) {
        if (filePath) {
            fs.stat(filePath, abind(function(err, stat) {
                var dependencies = [{path: filePath, mtime: stat.mtime.getTime()}];
                fs.readFile(filePath, abind(function(err, source) {
                    if (mime.lookup(filePath) == &#x27;text/css&#x27;) {
                        renderer.compressCSS(source+&#x27;&#x27;, staticPath, options,
                        function(err, source) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.pkg.shortenModulePath" id="apidoc.element.app.js.pkg.shortenModulePath">
        function <span class="apidocSignatureSpan">app.js.pkg.</span>shortenModulePath
        <span class="apidocSignatureSpan">(scriptPath, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">shortenModulePath = function (scriptPath, cb) {
    exports.findPackageInfo(scriptPath, abind(function(err, result) {
        // Read the package.json so we can use info contained within
        var dirName = path.dirname(result.path);
        var mainPath = path.resolve(dirName, result.info.main||&#x27;&#x27;);
        if (path.extname(mainPath) != &#x27;.js&#x27;) {
            mainPath += &#x27;.js&#x27;;
        }
        if (mainPath == scriptPath) {
            // If it&#x27;s the main script, shorten it to the package name
            cb(0, result.info.name);
        } else {
            // Remove the directories above the package directory
            var relativePath = scriptPath.substr(dirName.length+1);
            var relativeName = path.join(result.info.name, relativePath);

            // Remove .js extension if there is one
            var ext = path.extname(relativeName);
            if (ext == &#x27;.js&#x27;) {
                relativeName = path.join(path.dirname(relativeName),
                                         path.basename(relativeName, ext));
            }
            cb(0, relativeName);
        }
    }, cb));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        }
    }, fail, this));
}

function complete(foundPath) {
    try {
        var scriptPath = require.resolve(foundPath);
        exports.<span class="apidocCodeKeywordSpan">shortenModulePath</span>(scriptPath, abind(function(err, shortModulePath) {
            cb(0, {path: scriptPath, name: shortModulePath});
        }, fail, this));
    } catch (exc) {
        fail();
    }
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.pkg.shortenStaticPath" id="apidoc.element.app.js.pkg.shortenStaticPath">
        function <span class="apidocSignatureSpan">app.js.pkg.</span>shortenStaticPath
        <span class="apidocSignatureSpan">(resourcePath, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">shortenStaticPath = function (resourcePath, cb) {
    exports.findPackageInfo(resourcePath, abind(function(err, result) {
        var staticPath = readStaticPath(result);
        if (staticPath) {
            // Remove the directories above the package directory
            var relativePath = resourcePath.substr(staticPath.length+1);
            var relativeName = path.join(result.info.name, relativePath);
            cb(0, relativeName);
        } else {
            cb(0, null);
        }
    }, cb, this));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                if (err) { if (!--depth) cb(0, results); return; }
                fs.stat(stylesheetPath, _.bind(function(err, stat) {
                    if (err) { if (!--depth) cb(0, results); return; }

                    fs.readFile(stylesheetPath, _.bind(function(err, source) {
                        if (err) { if (!--depth) cb(0, results); return; }

                        exports.<span class="apidocCodeKeywordSpan">shortenStaticPath</span>(stylesheetPath, _.bind(function(err
, absolutePath) {
if (err) { if (!--depth) cb(0, results); return; }

styleMap[absolutePath] = {
    path: stylesheetPath,
    sourceURL: sourceURL,
    sourceLine: sourceLine,
    mtime: stat.mtime.getTime()
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.pkg.traceScript" id="apidoc.element.app.js.pkg.traceScript">
        function <span class="apidocSignatureSpan">app.js.pkg.</span>traceScript
        <span class="apidocSignatureSpan">(rootModuleName, searchPaths, skipDebug, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">traceScript = function (rootModuleName, searchPaths, skipDebug, cb) {
    var moduleMap = {};
    var styleMap = {};
    var iconMap = {};
    var imageMap = {};
    // XXXjoe array-indexof is used in appjs.js, so I should just trace appjs.js too!
    var hasMap = {&#x22;array-indexof&#x22;: true};
    var results = {js: moduleMap, css: styleMap, icons: iconMap, images: imageMap, has: hasMap};
    var depth = 0;
    var queue = [];


    enqueue(traceIcons, [rootModuleName]);
    enqueue(traceScript, [rootModuleName]);

    next();

    function traceScript(modulePath, basePath, sourceLine) {
        ++depth;

        var localPaths = searchPaths ? searchPaths.slice() : [];
        localPaths.push(basePath);
        exports.searchScript(modulePath, localPaths, tbind(function(err, findings) {
            if (findings.name in moduleMap) {
                next();
            } else {
                fs.stat(findings.path, tbind(function(err, stat) {
                    fs.readFile(findings.path, tbind(function(err, source) {
                        var pragmas = moduleMap[findings.name] = {
                            debug: !shouldTrace(modulePath),
                            path: findings.path,
                            source: source+&#x27;&#x27;,
                            sourceLine: sourceLine,
                            mtime: stat.mtime.getTime()
                        };

                        var m;
                        while ((m = rePragma.exec(source))) {
                            pragmas[m[1]] = 1;
                        }
                        _.each(hascan.findFeatureTests(source+&#x27;&#x27;), function(required, feature) {
                            hasMap[feature] = required;
                        });

                        if (!skipDebug || !pragmas.debug) {
                            while(m = reRequire.exec(source)) {
                                var depName = m[1];
                                enqueue(traceScript, [depName, findings.name, m[0]]);
                            }
                        }

                        while (m = reStyle.exec(source)) {
                            var stylesheetPath = exports.normalizeName(m[1], findings.name);
                            enqueue(traceStylesheet, [stylesheetPath, m[0]]);
                        }

                        next();
                    }, this));
                }, this));
            }
        }, this));
    }

    function traceStylesheet(stylesheetPath, sourceLine) {
        if (!(stylesheetPath in styleMap)) {
            ++depth;

            var localPaths = searchPaths ? searchPaths.slice() : [];
            // localPaths.push(basePath);

            exports.traceStylesheet(stylesheetPath, localPaths, true, null, sourceLine,
            tbind(function(err, res) {
                _.extend(results.css, res.css);
                _.extend(results.images, res.images);

                next();
            }, this));
        }
    }

    function traceIcons(modulePath, basePath) {
        ++depth;

        var localPaths = searchPaths ? searchPaths.slice() : [];
        localPaths.push(basePath);

        exports.searchScript(modulePath, localPaths, tbind(function(err, findings) {
            exports.findPackageStaticPath(findings.path, tbind(function(err, staticPath) {
                fs.readdir(staticPath, tbind(function(err, paths) {
                    _.each(paths, function(fileName) {
                        var m = reIconFiles.exec(fileName);
                        if (m) {
                            var filePath = path.join(staticPath, fileName);
                            fs.stat(filePath, function(err, stat) {
                                if (!err) {
                                    iconMap[fileName] = {path: filePath, mtime: stat.mtime.getTime()};
                                }
                            });
                        }
                    }, this);

                    next();
                }));
            }, this));
        }, this));
    }

    function enqueue(fn, args) {
        queue.push(function() { ...</pre></li>
    <li>example usage<pre class="apidocCodePre">...
            }, cb)
        );
    },

    _prepare: function(cb) {
        if (!this.dependencies) {
            var searchPaths = this.paths;
            pkg.<span class="apidocCodeKeywordSpan">traceScript</span>(this.client, this.paths, false, abind(function(err, deps) {
this.dependencies = deps;

async.parallel([
    ibind(function(next) {
        hascan.getFeatureDB(_.keys(deps.has), abind(function(err, featureDB) {
            this.featureDB = featureDB;
            next(0);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.pkg.traceStylesheet" id="apidoc.element.app.js.pkg.traceStylesheet">
        function <span class="apidocSignatureSpan">app.js.pkg.</span>traceStylesheet
        <span class="apidocSignatureSpan">(modulePath, searchPaths, recursive, source, sourceLine, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">traceStylesheet = function (modulePath, searchPaths, recursive, source, sourceLine, cb) {
    var styleMap = {};
    var imageMap = {};
    var results = {css: styleMap, images: imageMap};
    var depth = 0;

    if (recursive) {
        traceStylesheet.apply(this, [modulePath, sourceLine]);
    } else {
        scanSource.apply(this, [source, path.dirname(modulePath)]);
    }

    function scanSource(source, basePath) {
        ++depth;

        var m;
        while ((m = reCSSImport.exec(source)) &#x26;&#x26; m[2]) {
            var stylesheetPath = exports.normalizeName(m[2], basePath, true);
            traceStylesheet.apply(this, [stylesheetPath, m[1], m[0]]);
        }

        while ((m = reCSSURL.exec(source)) &#x26;&#x26; m[1]) {
            var imagePath = exports.normalizeName(m[1], basePath, true);
            traceImage.apply(this, [imagePath, m[1], m[0]]);
        }

        if (!--depth) {
            cb(0, results);
        }
    }

    function traceStylesheet(stylesheetPath, sourceURL, sourceLine) {
        if (!(stylesheetPath in styleMap)) {
            ++depth;

            exports.searchStatic(stylesheetPath, searchPaths, false, _.bind(function(err, stylesheetPath) {
                if (err) { if (!--depth) cb(0, results); return; }
                fs.stat(stylesheetPath, _.bind(function(err, stat) {
                    if (err) { if (!--depth) cb(0, results); return; }

                    fs.readFile(stylesheetPath, _.bind(function(err, source) {
                        if (err) { if (!--depth) cb(0, results); return; }

                        exports.shortenStaticPath(stylesheetPath, _.bind(function(err, absolutePath) {
                            if (err) { if (!--depth) cb(0, results); return; }

                            styleMap[absolutePath] = {
                                path: stylesheetPath,
                                sourceURL: sourceURL,
                                sourceLine: sourceLine,
                                mtime: stat.mtime.getTime()
                            };

                            if (recursive) {
                                scanSource.apply(this, [source, path.dirname(absolutePath), true]);
                            }

                            if (!--depth) {
                                cb(0, results);
                            }
                        }, this));
                    }, this));
                }, this));
            }, this));
        }
    }

    function traceImage(modulePath, sourceURL, sourceLine) {
        if (!(modulePath in styleMap)) {
            ++depth;

            exports.searchStatic(modulePath, searchPaths, true, _.bind(function(err, imagePath) {
                if (err) { if (!--depth) cb(0, results); return; }

                fs.stat(imagePath, _.bind(function(err, stat) {
                    if (err) { if (!--depth) cb(0, results); return; }

                    imageMap[modulePath] = {
                        path: imagePath,
                        sourceURL: sourceURL,
                        sourceLine: sourceLine,
                        mtime: stat.mtime.getTime()
                    };

                    if (!--depth) {
                        cb(0, results);
                    }
                }, this));
            }, this));
        }
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
} catch (exc) {
    console.error(&#x27;Error compressing JavaScript&#x27;, exc);
    return source;
}
    },

    compressCSS: function(source, baseURL, options, cb) {
pkg.<span class="apidocCodeKeywordSpan">traceStylesheet</span>(baseURL, this.app.paths, false, source, null, abind(inlineImages,
cb, this));

function inlineImages(err, deps) {
    async.map(_.keys(deps.images),
        _.bind(function(imagePath, cb2) {
            var imageURL = this.renderURL(this.app.staticPath + &#x27;/&#x27; + imagePath, &#x27;images&#x27;);
            var sourceURL = deps.images[imagePath].sourceURL;
            if (options.images == &#x22;inline&#x22;) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.app.js.pkg.traceStylesheets" id="apidoc.element.app.js.pkg.traceStylesheets">
        function <span class="apidocSignatureSpan">app.js.pkg.</span>traceStylesheets
        <span class="apidocSignatureSpan">(rootModuleName, searchPaths, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">traceStylesheets = function (rootModuleName, searchPaths, cb) {
    var styleMap = {};
    var depth = 0;

    traceScript.apply(this, [rootModuleName]);

    function traceScript(modulePath, basePath, sourceLine) {
        ++depth;

        exports.searchScript(modulePath, basePath, tbind(function(err, findings) {
            fs.stat(findings.path, tbind(function(err, stat) {
                fs.readFile(findings.path, tbind(function(err, source) {
                    var m;
                    while (m = reStyle.exec(source)) {
                        var stylesheetPath = exports.normalizeName(m[1], findings.name);
                        traceStylesheet.apply(this, [stylesheetPath, m[0]]);
                    }

                    complete();
                }, this));
            }, this));
        }, this));
    }

    function traceStylesheet(stylesheetPath, sourceLine) {
        if (!(stylesheetPath in styleMap)) {
            ++depth;

            exports.traceStylesheet(stylesheetPath, searchPaths, true, null, sourceLine,
            tbind(function(err, res) {
                _.extend(styleMap, res.css);

                complete();
            }, this));
        }
    }

    function tbind(fn, self) {
        return function(err, obj) {
            if (err) {
                if (!--depth) {
                    cb(0, styleMap);
                }
            } else {
                try {
                    fn.apply(self, [0, obj]);
                } catch (exc) {
                    cb(exc);
                }
            }
        }
    }

    function complete() {
        if (!--depth) {
            cb(0, styleMap);
        }
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    renderScriptDebug: function(scriptPath, modulePath, options, cb) {
        var deps = [];
        async.parallel([
            ibind(function(next) {
                if (options.css == &#x22;included&#x22;) {
                    return next(0, &#x27;&#x27;); // XXXjoe Temporary

                    pkg.<span class="apidocCodeKeywordSpan">traceStylesheets</span>(scriptPath, this.app.paths, abind(function(err
, cssMap) {
var sections = _.map(cssMap, _.bind(function(dep, urlPath) {
    deps.push(dep);

    var stylesheetPath = this.app.staticPath + &#x27;/&#x27; + urlPath;
    var stylesheetURL = this.renderURL(stylesheetPath, &#x27;css&#x27;);
    return &#x27;require.stylesheet(&#x22;&#x27; + stylesheetURL + &#x27;&#x22;);&#x27;;
}, this));
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.app.js.route" id="apidoc.module.app.js.route">module app.js.route</a></h1>


    <h2>
        <a href="#apidoc.element.app.js.route.route" id="apidoc.element.app.js.route.route">
        function <span class="apidocSignatureSpan">app.js.</span>route
        <span class="apidocSignatureSpan">(conf)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">route = function (conf) {
    var app = new App(conf);
    return app.route();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.app.js.run" id="apidoc.module.app.js.run">module app.js.run</a></h1>


    <h2>
        <a href="#apidoc.element.app.js.run.run" id="apidoc.element.app.js.run.run">
        function <span class="apidocSignatureSpan">app.js.</span>run
        <span class="apidocSignatureSpan">(argv)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">run = function (argv) {
    if (argv.pack) {
        process.env.NODE_ENV = &#x27;production&#x27;;
        process.env.APPJSPACK = true;
    }

    createServersFromConf(argv, function(err, servers) {
        if (err || !servers.length) {
            dandy.logException(&#x22;No sites loaded.&#x22;);
        } else {
            if (argv.pack) {
                var port = 8081;
                var server = getPackServer(servers, argv.pack);
                var httpServer = server.listen(port);

                if (server.appVersion) {
                    server.appVersion = incrementRepoVersion(server.appVersion);
                } else {
                    server.appVersion = &#x27;v0.0&#x27;;
                }

                console.log(&#x27;Creating version&#x27;, server.appVersion);

                saveRepoVersion(server.repoPath, server.appVersion);
                server.appjsApp.appVersion = server.appVersion;

                packServer(server, port, function(err) {
                    if (err) {
                        console.log(err);
                    } else {
                        console.log(&#x27;done.&#x27;);
                    }
                    process.exit(0);
                });
            } else {
                var port = argv.port || defaultPort;
                var server = getMainServer(servers, argv);
                server.listen(port);
                console.log(&#x22;App.js server listening on port %d (%s)&#x22;, server.address().port,
                            new Date());
            }
        }
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.app.js.searchScript" id="apidoc.module.app.js.searchScript">module app.js.searchScript</a></h1>


    <h2>
        <a href="#apidoc.element.app.js.searchScript.searchScript" id="apidoc.element.app.js.searchScript.searchScript">
        function <span class="apidocSignatureSpan">app.js.</span>searchScript
        <span class="apidocSignatureSpan">(modulePath, searchPaths, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">searchScript = function (modulePath, searchPaths, cb) {
    if (typeof(searchPaths) == &#x27;function&#x27;) { cb = searchPaths; searchPaths = null; }

    if (!(searchPaths instanceof Array)) {
        searchPaths = [searchPaths];
    } else {
        searchPaths = searchPaths.slice();
        searchPaths.push(null);
    }

    if (process.env.NODE_PATH) {
        searchPaths.push.apply(searchPaths, process.env.NODE_PATH.split(&#x27;;&#x27;));
    }

    if (modulePath[0] == &#x27;/&#x27;) {
        complete(modulePath);
    } else {
        searchBasePath(searchPaths.shift());
    }

    function searchBasePath(basePath) {
        var baseScriptPath;
        if (basePath) {
            try {
                baseScriptPath = path.dirname(require.resolve(basePath));
            } catch (exc) {
                baseScriptPath = basePath;
            }
        }
        if (baseScriptPath) {
            var absolutePath = path.resolve(baseScriptPath, modulePath);
            try {
                var scriptPath = require.resolve(absolutePath);
                return complete(scriptPath);
            } catch (exc) {

            }
        }

        if (baseScriptPath) {
            var baseDir = baseScriptPath;
            findInNodeModules(baseDir);
        } else {
            complete(modulePath);
        }
    }

<span class="apidocCodeCommentSpan">    /**
     * require.resolve unfortunately can&#x27;t be given a relative base path, so we have
     * to simulate its behavior ourself.  This here does the node_modules search.
     */
</span>    function findInNodeModules(containerPath) {
        fs.stat(containerPath, abind(function(err, stat) {
            if (stat.isDirectory()) {
                var foundPath = path.resolve(containerPath, &#x27;node_modules&#x27;, modulePath);
                try {
                    foundPath = require.resolve(foundPath);
                    complete(foundPath);
                } catch (exc) {
                    if (containerPath != &#x27;/&#x27;) {
                        findInNodeModules(path.dirname(containerPath));
                    } else {
                        tryNext();
                    }
                }
            } else {
                tryNext();
            }
        }, fail, this));
    }

    function complete(foundPath) {
        try {
            var scriptPath = require.resolve(foundPath);
            exports.shortenModulePath(scriptPath, abind(function(err, shortModulePath) {
                cb(0, {path: scriptPath, name: shortModulePath});
            }, fail, this));
        } catch (exc) {
            fail();
        }
    }

    function tryNext() {
        if (!searchPaths.length) {
            fail();
        } else {
            var nextPath = searchPaths.shift();
            searchBasePath(nextPath);
        }
    }

    function fail() {
        cb(new Error(&#x22;Module &#x27;&#x22; + modulePath + &#x22;&#x27; not found.&#x22;));
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var basePath = scriptPath == this.client ? null : this.client;

var searchPaths = [basePath];
if (this.paths.length) {
    searchPaths.push.apply(searchPaths, this.paths);
}

pkg.<span class="apidocCodeKeywordSpan">searchScript</span>(scriptPath, searchPaths, abind(function(err, findings) {
    if (findings) {
        renderer.renderScript(findings.path, findings.name, options, true,
            abind(function(err, result) {
                cb(0, {path: findings.path, name: findings.name, body: result.source,
                       dependencies: result.dependencies, permanent: true});
            }, cb)
        );
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.app.js.searchStatic" id="apidoc.module.app.js.searchStatic">module app.js.searchStatic</a></h1>


    <h2>
        <a href="#apidoc.element.app.js.searchStatic.searchStatic" id="apidoc.element.app.js.searchStatic.searchStatic">
        function <span class="apidocSignatureSpan">app.js.</span>searchStatic
        <span class="apidocSignatureSpan">(modulePath, searchPaths, isURL, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">searchStatic = function (modulePath, searchPaths, isURL, cb) {
    if (typeof(isURL) == &#x27;function&#x27;) { cb = isURL; isURL = false; }
    if (typeof(searchPaths) == &#x27;function&#x27;) { cb = searchPaths; searchPaths = null; }

    modulePath = securePath(modulePath);
    if (!modulePath) { cb(&#x22;Illegal path&#x22;); return; }

    findBasePath(abind(function(err, basePath) {
        try {
            var parts = modulePath.split(&#x27;/&#x27;);
            if (!parts.length) {
                cb(0, &#x27;&#x27;);
            }

            exports.findPackageStaticPath(basePath, abind(function(err, staticPath) {
                var filePath = path.join(staticPath, parts.slice(1).join(&#x27;/&#x27;));
                cb(0, filePath);
            }, cb, this));
        } catch (exc) {
            console.error(exc.stack)
            cb(exc);
        }
    }, cb, this));

    function findBasePath(cb) {
        if (modulePath[0] == &#x27;.&#x27;) {
            cb(0, searchPaths[0]);
        } else {
            var baseModule = modulePath.split(&#x27;/&#x27;)[0];
            exports.searchScript(baseModule, searchPaths, abind(function(err, findings) {
                if (isURL) {
                    cb(0, findings.path);
                } else {
                    cb(0, findings.path);
                }
            }, cb, this));
        }
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
            permanent: options.js == &#x22;inline&#x22; &#x26;&#x26; options.css == &#x22;inline&#x22;,
            dependencies: result.dependencies,
        });
    }, cb));
},

_loadStatic: function(staticPath, renderer, options, cb) {
    pkg.<span class="apidocCodeKeywordSpan">searchStatic</span>(staticPath, this.paths, abind(function(err, filePath) {
        if (filePath) {
            fs.stat(filePath, abind(function(err, stat) {
                var dependencies = [{path: filePath, mtime: stat.mtime.getTime()}];
                fs.readFile(filePath, abind(function(err, source) {
                    if (mime.lookup(filePath) == &#x27;text/css&#x27;) {
                        renderer.compressCSS(source+&#x27;&#x27;, staticPath, options,
                        function(err, source) {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.app.js.shortenStaticPath" id="apidoc.module.app.js.shortenStaticPath">module app.js.shortenStaticPath</a></h1>


    <h2>
        <a href="#apidoc.element.app.js.shortenStaticPath.shortenStaticPath" id="apidoc.element.app.js.shortenStaticPath.shortenStaticPath">
        function <span class="apidocSignatureSpan">app.js.</span>shortenStaticPath
        <span class="apidocSignatureSpan">(resourcePath, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">shortenStaticPath = function (resourcePath, cb) {
    exports.findPackageInfo(resourcePath, abind(function(err, result) {
        var staticPath = readStaticPath(result);
        if (staticPath) {
            // Remove the directories above the package directory
            var relativePath = resourcePath.substr(staticPath.length+1);
            var relativeName = path.join(result.info.name, relativePath);
            cb(0, relativeName);
        } else {
            cb(0, null);
        }
    }, cb, this));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                if (err) { if (!--depth) cb(0, results); return; }
                fs.stat(stylesheetPath, _.bind(function(err, stat) {
                    if (err) { if (!--depth) cb(0, results); return; }

                    fs.readFile(stylesheetPath, _.bind(function(err, source) {
                        if (err) { if (!--depth) cb(0, results); return; }

                        exports.<span class="apidocCodeKeywordSpan">shortenStaticPath</span>(stylesheetPath, _.bind(function(err
, absolutePath) {
if (err) { if (!--depth) cb(0, results); return; }

styleMap[absolutePath] = {
    path: stylesheetPath,
    sourceURL: sourceURL,
    sourceLine: sourceLine,
    mtime: stat.mtime.getTime()
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.app.js.utils" id="apidoc.module.app.js.utils">module app.js.utils</a></h1>


    <h2>
        <a href="#apidoc.element.app.js.utils.sendSafely" id="apidoc.element.app.js.utils.sendSafely">
        function <span class="apidocSignatureSpan">app.js.utils.</span>sendSafely
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">sendSafely = function (cb) {
    var res = this;
    var req = res.req;
    try {
        return cb(sbind(function(err, result) {
            if (err) {
                sendError(req, res, err, typeof(err) == &#x27;object&#x27; ? err.error : 500, result);
            } else if (result.path) {
            	sendFile(req, res, result);
            } else {
                sendData(req, res, result);
            }
        }, this));
    } catch (exc) {
        sendError(req, res, exc);
    }

    function sbind(fn, self) {
        return function() {
            try {
                return fn.apply(self, arguments);
            } catch (exc) {
                sendError(req, res, exc);
            }
        }
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
